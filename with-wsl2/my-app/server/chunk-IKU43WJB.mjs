import './polyfills.server.mjs';
import{a as Ee,b as Xe,c as Qn,d as et,e as qt,f as Zn,g as Yn,h as Jn,i as Xn,j as er,m as tr,q as ir,r as nr,s as Kt,u as Qt,v as tt,w as $i}from"./chunk-6HOWWAYB.mjs";import{$a as _,$b as zn,A as Mn,Aa as Nn,C as Ht,Db as zt,E as Ut,G as Wt,Ga as m,Ha as f,I as Gt,Ia as Ln,Ja as jn,Jb as bt,Ka as Bn,Kb as Ye,La as ft,Lb as ye,M as Fn,N as Pn,Na as Hn,Nb as Gi,O as On,Oa as Ze,P as Rn,Pa as G,Q as Ui,Qb as Te,R as Qe,T as ie,Ta as B,U as I,V as L,Va as Ne,Wa as S,X as ee,Xa as q,Xb as $n,Ya as se,Z as C,Za as d,Zb as de,_ as ne,_a as c,_b as Je,ab as le,ac as qn,bb as y,bc as Kn,c as xn,ca as k,cb as oe,da as j,db as Le,dc as Ce,ea as M,eb as l,f as Ve,fa as Vn,fb as A,g as Vt,ga as $t,gb as H,hb as Un,i as Nt,ib as P,j as J,jb as O,k as Lt,ka as ve,kb as R,la as E,lb as K,ma as D,n as ge,na as me,nb as je,o as Sn,ob as Wn,p as W,pb as gt,q as jt,r as Bt,ra as pe,sa as be,t as Tn,ua as re,v as En,vb as Gn,w as Dn,x as te,y as An,ya as Se,z as Ke,za as Wi}from"./chunk-5P67MN7V.mjs";import{a as U,b as ce,h as z}from"./chunk-5XUXGTUW.mjs";var mr=(()=>{let e=class e{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}};e.\u0275fac=function(r){return new(r||e)(f(ft),f(re))},e.\u0275dir=M({type:e});let n=e;return n})(),kt=(()=>{let e=class e extends mr{};e.\u0275fac=(()=>{let t;return function(s){return(t||(t=me(e)))(s||e)}})(),e.\u0275dir=M({type:e,features:[G]});let n=e;return n})(),He=new ee(""),ys={provide:He,useExisting:ie(()=>Yi),multi:!0},Yi=(()=>{let e=class e extends kt{writeValue(t){this.setProperty("checked",t)}};e.\u0275fac=(()=>{let t;return function(s){return(t||(t=me(e)))(s||e)}})(),e.\u0275dir=M({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,s){r&1&&y("change",function(a){return s.onChange(a.target.checked)})("blur",function(){return s.onTouched()})},features:[K([ys]),G]});let n=e;return n})(),Cs={provide:He,useExisting:ie(()=>Q),multi:!0};function ws(){let n=Gi()?Gi().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var Is=new ee(""),Q=(()=>{let e=class e extends mr{constructor(t,r,s){super(t,r),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!ws())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}};e.\u0275fac=function(r){return new(r||e)(f(ft),f(re),f(Is,8))},e.\u0275dir=M({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,s){r&1&&y("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[K([Cs]),G]});let n=e;return n})();function De(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function pr(n){return n!=null&&typeof n.length=="number"}var Ue=new ee(""),si=new ee(""),ks=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,ue=class{static min(e){return xs(e)}static max(e){return Ss(e)}static required(e){return fr(e)}static requiredTrue(e){return Ts(e)}static email(e){return Es(e)}static minLength(e){return gr(e)}static maxLength(e){return Ds(e)}static pattern(e){return br(e)}static nullValidator(e){return Yt(e)}static compose(e){return Ir(e)}static composeAsync(e){return kr(e)}};function xs(n){return e=>{if(De(e.value)||De(n))return null;let i=parseFloat(e.value);return!isNaN(i)&&i<n?{min:{min:n,actual:e.value}}:null}}function Ss(n){return e=>{if(De(e.value)||De(n))return null;let i=parseFloat(e.value);return!isNaN(i)&&i>n?{max:{max:n,actual:e.value}}:null}}function fr(n){return De(n.value)?{required:!0}:null}function Ts(n){return n.value===!0?null:{required:!0}}function Es(n){return De(n.value)||ks.test(n.value)?null:{email:!0}}function gr(n){return e=>De(e.value)||!pr(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function Ds(n){return e=>pr(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function br(n){if(!n)return Yt;let e,i;return typeof n=="string"?(i="",n.charAt(0)!=="^"&&(i+="^"),i+=n,n.charAt(n.length-1)!=="$"&&(i+="$"),e=new RegExp(i)):(i=n.toString(),e=n),t=>{if(De(t.value))return null;let r=t.value;return e.test(r)?null:{pattern:{requiredPattern:i,actualValue:r}}}}function Yt(n){return null}function _r(n){return n!=null}function vr(n){return Gn(n)?Nt(n):n}function yr(n){let e={};return n.forEach(i=>{e=i!=null?U(U({},e),i):e}),Object.keys(e).length===0?null:e}function Cr(n,e){return e.map(i=>i(n))}function As(n){return!n.validate}function wr(n){return n.map(e=>As(e)?e:i=>e.validate(i))}function Ir(n){if(!n)return null;let e=n.filter(_r);return e.length==0?null:function(i){return yr(Cr(i,e))}}function Ji(n){return n!=null?Ir(wr(n)):null}function kr(n){if(!n)return null;let e=n.filter(_r);return e.length==0?null:function(i){let t=Cr(i,e).map(vr);return En(t).pipe(W(yr))}}function Xi(n){return n!=null?kr(wr(n)):null}function rr(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function xr(n){return n._rawValidators}function Sr(n){return n._rawAsyncValidators}function zi(n){return n?Array.isArray(n)?n:[n]:[]}function Jt(n,e){return Array.isArray(n)?n.includes(e):n===e}function sr(n,e){let i=zi(e);return zi(n).forEach(r=>{Jt(i,r)||i.push(r)}),i}function or(n,e){return zi(e).filter(i=>!Jt(n,i))}var Xt=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Ji(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Xi(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,i){return this.control?this.control.hasError(e,i):!1}getError(e,i){return this.control?this.control.getError(e,i):null}},we=class extends Xt{get formDirective(){return null}get path(){return null}},Be=class extends Xt{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},ei=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Ms={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},va=ce(U({},Ms),{"[class.ng-submitted]":"isSubmitted"}),Z=(()=>{let e=class e extends ei{constructor(t){super(t)}};e.\u0275fac=function(r){return new(r||e)(f(Be,2))},e.\u0275dir=M({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,s){r&2&&se("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[G]});let n=e;return n})(),ot=(()=>{let e=class e extends ei{constructor(t){super(t)}};e.\u0275fac=function(r){return new(r||e)(f(we,10))},e.\u0275dir=M({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,s){r&2&&se("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[G]});let n=e;return n})();var _t="VALID",Zt="INVALID",it="PENDING",vt="DISABLED",Ae=class{},ti=class extends Ae{constructor(e,i){super(),this.value=e,this.source=i}},Ct=class extends Ae{constructor(e,i){super(),this.pristine=e,this.source=i}},wt=class extends Ae{constructor(e,i){super(),this.touched=e,this.source=i}},nt=class extends Ae{constructor(e,i){super(),this.status=e,this.source=i}},qi=class extends Ae{constructor(e){super(),this.source=e}},Ki=class extends Ae{constructor(e){super(),this.source=e}};function en(n){return(oi(n)?n.validators:n)||null}function Fs(n){return Array.isArray(n)?Ji(n):n||null}function tn(n,e){return(oi(e)?e.asyncValidators:n)||null}function Ps(n){return Array.isArray(n)?Xi(n):n||null}function oi(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function Tr(n,e,i){let t=n.controls;if(!(e?Object.keys(t):t).length)throw new Qe(1e3,"");if(!t[i])throw new Qe(1001,"")}function Er(n,e,i){n._forEachChild((t,r)=>{if(i[r]===void 0)throw new Qe(1002,"")})}var rt=class{constructor(e,i){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Ye(()=>this.statusReactive()),this.statusReactive=Ze(void 0),this._pristine=Ye(()=>this.pristineReactive()),this.pristineReactive=Ze(!0),this._touched=Ye(()=>this.touchedReactive()),this.touchedReactive=Ze(!1),this._events=new Ve,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return ye(this.statusReactive)}set status(e){ye(()=>this.statusReactive.set(e))}get valid(){return this.status===_t}get invalid(){return this.status===Zt}get pending(){return this.status==it}get disabled(){return this.status===vt}get enabled(){return this.status!==vt}get pristine(){return ye(this.pristineReactive)}set pristine(e){ye(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return ye(this.touchedReactive)}set touched(e){ye(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(sr(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(sr(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(or(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(or(e,this._rawAsyncValidators))}hasValidator(e){return Jt(this._rawValidators,e)}hasAsyncValidator(e){return Jt(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let i=this.touched===!1;this.touched=!0;let t=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(ce(U({},e),{sourceControl:t})),i&&e.emitEvent!==!1&&this._events.next(new wt(!0,t))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(i=>i.markAllAsTouched(e))}markAsUntouched(e={}){let i=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let t=e.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:t})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t),i&&e.emitEvent!==!1&&this._events.next(new wt(!1,t))}markAsDirty(e={}){let i=this.pristine===!0;this.pristine=!1;let t=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(ce(U({},e),{sourceControl:t})),i&&e.emitEvent!==!1&&this._events.next(new Ct(!1,t))}markAsPristine(e={}){let i=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let t=e.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&e.emitEvent!==!1&&this._events.next(new Ct(!0,t))}markAsPending(e={}){this.status=it;let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new nt(this.status,i)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(ce(U({},e),{sourceControl:i}))}disable(e={}){let i=this._parentMarkedDirty(e.onlySelf);this.status=vt,this.errors=null,this._forEachChild(r=>{r.disable(ce(U({},e),{onlySelf:!0}))}),this._updateValue();let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new ti(this.value,t)),this._events.next(new nt(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(ce(U({},e),{skipPristineCheck:i}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let i=this._parentMarkedDirty(e.onlySelf);this.status=_t,this._forEachChild(t=>{t.enable(ce(U({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(ce(U({},e),{skipPristineCheck:i}),this),this._onDisabledChange.forEach(t=>t(!1))}_updateAncestors(e,i){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},i),this._parent._updateTouched({},i))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let t=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===_t||this.status===it)&&this._runAsyncValidator(t,e.emitEvent)}let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new ti(this.value,i)),this._events.next(new nt(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(ce(U({},e),{sourceControl:i}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?vt:_t}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,i){if(this.asyncValidator){this.status=it,this._hasOwnPendingAsyncValidator={emitEvent:i!==!1};let t=vr(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:i,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,i={}){this.errors=e,this._updateControlsErrors(i.emitEvent!==!1,this,i.shouldHaveEmitted)}get(e){let i=e;return i==null||(Array.isArray(i)||(i=i.split(".")),i.length===0)?null:i.reduce((t,r)=>t&&t._find(r),this)}getError(e,i){let t=i?this.get(i):this;return t&&t.errors?t.errors[e]:null}hasError(e,i){return!!this.getError(e,i)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,i,t){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||t)&&this._events.next(new nt(this.status,i)),this._parent&&this._parent._updateControlsErrors(e,i,t)}_initObservables(){this.valueChanges=new pe,this.statusChanges=new pe}_calculateStatus(){return this._allControlsDisabled()?vt:this.errors?Zt:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(it)?it:this._anyControlsHaveStatus(Zt)?Zt:_t}_anyControlsHaveStatus(e){return this._anyControls(i=>i.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,i){let t=!this._anyControlsDirty(),r=this.pristine!==t;this.pristine=t,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,i),r&&this._events.next(new Ct(this.pristine,i))}_updateTouched(e={},i){this.touched=this._anyControlsTouched(),this._events.next(new wt(this.touched,i)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,i)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){oi(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let i=this._parent&&this._parent.dirty;return!e&&!!i&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=Fs(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=Ps(this._rawAsyncValidators)}},st=class extends rt{constructor(e,i,t){super(en(i),tn(t,i)),this.controls=e,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,i){return this.controls[e]?this.controls[e]:(this.controls[e]=i,i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange),i)}addControl(e,i,t={}){this.registerControl(e,i),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}removeControl(e,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}setControl(e,i,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],i&&this.registerControl(e,i),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,i={}){Er(this,!0,e),Object.keys(e).forEach(t=>{Tr(this,!0,t),this.controls[t].setValue(e[t],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(e,i={}){e!=null&&(Object.keys(e).forEach(t=>{let r=this.controls[t];r&&r.patchValue(e[t],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(e={},i={}){this._forEachChild((t,r)=>{t.reset(e?e[r]:null,{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i,this),this._updateTouched(i,this),this.updateValueAndValidity(i)}getRawValue(){return this._reduceChildren({},(e,i,t)=>(e[t]=i.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(i,t)=>t._syncPendingControls()?!0:i);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(i=>{let t=this.controls[i];t&&e(t,i)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[i,t]of Object.entries(this.controls))if(this.contains(i)&&e(t))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(i,t,r)=>((t.enabled||this.disabled)&&(i[r]=t.value),i))}_reduceChildren(e,i){let t=e;return this._forEachChild((r,s)=>{t=i(t,r,s)}),t}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var Qi=class extends st{};var xt=new ee("CallSetDisabledState",{providedIn:"root",factory:()=>ai}),ai="always";function Dr(n,e){return[...e.path,n]}function ii(n,e,i=ai){nn(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||i==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),Rs(n,e),Ns(n,e),Vs(n,e),Os(n,e)}function ar(n,e,i=!0){let t=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(t),e.valueAccessor.registerOnTouched(t)),ri(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function ni(n,e){n.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(e)})}function Os(n,e){if(e.valueAccessor.setDisabledState){let i=t=>{e.valueAccessor.setDisabledState(t)};n.registerOnDisabledChange(i),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(i)})}}function nn(n,e){let i=xr(n);e.validator!==null?n.setValidators(rr(i,e.validator)):typeof i=="function"&&n.setValidators([i]);let t=Sr(n);e.asyncValidator!==null?n.setAsyncValidators(rr(t,e.asyncValidator)):typeof t=="function"&&n.setAsyncValidators([t]);let r=()=>n.updateValueAndValidity();ni(e._rawValidators,r),ni(e._rawAsyncValidators,r)}function ri(n,e){let i=!1;if(n!==null){if(e.validator!==null){let r=xr(n);if(Array.isArray(r)&&r.length>0){let s=r.filter(o=>o!==e.validator);s.length!==r.length&&(i=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let r=Sr(n);if(Array.isArray(r)&&r.length>0){let s=r.filter(o=>o!==e.asyncValidator);s.length!==r.length&&(i=!0,n.setAsyncValidators(s))}}}let t=()=>{};return ni(e._rawValidators,t),ni(e._rawAsyncValidators,t),i}function Rs(n,e){e.valueAccessor.registerOnChange(i=>{n._pendingValue=i,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&Ar(n,e)})}function Vs(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&Ar(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function Ar(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Ns(n,e){let i=(t,r)=>{e.valueAccessor.writeValue(t),r&&e.viewToModelUpdate(t)};n.registerOnChange(i),e._registerOnDestroy(()=>{n._unregisterOnChange(i)})}function Mr(n,e){n==null,nn(n,e)}function Ls(n,e){return ri(n,e)}function Fr(n,e){if(!n.hasOwnProperty("model"))return!1;let i=n.model;return i.isFirstChange()?!0:!Object.is(e,i.currentValue)}function js(n){return Object.getPrototypeOf(n.constructor)===kt}function Pr(n,e){n._syncPendingControls(),e.forEach(i=>{let t=i.control;t.updateOn==="submit"&&t._pendingChange&&(i.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)})}function Or(n,e){if(!e)return null;Array.isArray(e);let i,t,r;return e.forEach(s=>{s.constructor===Q?i=s:js(s)?t=s:r=s}),r||t||i||null}function Bs(n,e){let i=n.indexOf(e);i>-1&&n.splice(i,1)}var Hs={provide:we,useExisting:ie(()=>St)},yt=Promise.resolve(),St=(()=>{let e=class e extends we{get submitted(){return ye(this.submittedReactive)}constructor(t,r,s){super(),this.callSetDisabledState=s,this._submitted=Ye(()=>this.submittedReactive()),this.submittedReactive=Ze(!1),this._directives=new Set,this.ngSubmit=new pe,this.form=new st({},Ji(t),Xi(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){yt.then(()=>{let r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),ii(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){yt.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){yt.then(()=>{let r=this._findContainer(t.path),s=new st({});Mr(s,t),r.registerControl(t.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){yt.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){yt.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),Pr(this.form,this._directives),this.ngSubmit.emit(t),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}};e.\u0275fac=function(r){return new(r||e)(f(Ue,10),f(si,10),f(xt,8))},e.\u0275dir=M({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,s){r&1&&y("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[K([Hs]),G]});let n=e;return n})();function cr(n,e){let i=n.indexOf(e);i>-1&&n.splice(i,1)}function lr(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var It=class extends rt{constructor(e=null,i,t){super(en(i),tn(t,i)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),oi(i)&&(i.nonNullable||i.initialValueIsDefault)&&(lr(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,i={}){this.value=this._pendingValue=e,this._onChange.length&&i.emitModelToViewChange!==!1&&this._onChange.forEach(t=>t(this.value,i.emitViewToModelChange!==!1)),this.updateValueAndValidity(i)}patchValue(e,i={}){this.setValue(e,i)}reset(e=this.defaultValue,i={}){this._applyFormState(e),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){cr(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){cr(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){lr(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Us=n=>n instanceof It;var Ws={provide:Be,useExisting:ie(()=>X)},dr=Promise.resolve(),X=(()=>{let e=class e extends Be{constructor(t,r,s,o,a,u){super(),this._changeDetectorRef=a,this.callSetDisabledState=u,this.control=new It,this._registered=!1,this.name="",this.update=new pe,this._parent=t,this._setValidators(r),this._setAsyncValidators(s),this.valueAccessor=Or(this,o)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),Fr(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){ii(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){dr.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let r=t.isDisabled.currentValue,s=r!==0&&bt(r);dr.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?Dr(t,this._parent):[t]}};e.\u0275fac=function(r){return new(r||e)(f(we,9),f(Ue,10),f(si,10),f(He,10),f(zt,8),f(xt,8))},e.\u0275dir=M({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[K([Ws]),G,ve]});let n=e;return n})(),at=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=M({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})(),Gs={provide:He,useExisting:ie(()=>Ie),multi:!0},Ie=(()=>{let e=class e extends kt{writeValue(t){let r=t??"";this.setProperty("value",r)}registerOnChange(t){this.onChange=r=>{t(r==""?null:parseFloat(r))}}};e.\u0275fac=(()=>{let t;return function(s){return(t||(t=me(e)))(s||e)}})(),e.\u0275dir=M({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,s){r&1&&y("input",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},features:[K([Gs]),G]});let n=e;return n})();var Rr=new ee("");var $s={provide:we,useExisting:ie(()=>rn)},rn=(()=>{let e=class e extends we{get submitted(){return ye(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}constructor(t,r,s){super(),this.callSetDisabledState=s,this._submitted=Ye(()=>this._submittedReactive()),this._submittedReactive=Ze(!1),this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new pe,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(ri(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){let r=this.form.get(t.path);return ii(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){ar(t.control||null,t,!1),Bs(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this._submittedReactive.set(!0),Pr(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new qi(this.control)),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this._submittedReactive.set(!1),this.form._events.next(new Ki(this.form))}_updateDomValue(){this.directives.forEach(t=>{let r=t.control,s=this.form.get(t.path);r!==s&&(ar(r||null,t),Us(s)&&(ii(s,t,this.callSetDisabledState),t.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){let r=this.form.get(t.path);Mr(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){let r=this.form.get(t.path);r&&Ls(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){nn(this.form,this),this._oldForm&&ri(this._oldForm,this)}_checkFormPresent(){this.form}};e.\u0275fac=function(r){return new(r||e)(f(Ue,10),f(si,10),f(xt,8))},e.\u0275dir=M({type:e,selectors:[["","formGroup",""]],hostBindings:function(r,s){r&1&&y("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[K([$s]),G,ve]});let n=e;return n})();var zs={provide:Be,useExisting:ie(()=>sn)},sn=(()=>{let e=class e extends Be{set isDisabled(t){}constructor(t,r,s,o,a){super(),this._ngModelWarningConfig=a,this._added=!1,this.name=null,this.update=new pe,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(s),this.valueAccessor=Or(this,o)}ngOnChanges(t){this._added||this._setUpControl(),Fr(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return Dr(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};e._ngModelWarningSentOnce=!1,e.\u0275fac=function(r){return new(r||e)(f(we,13),f(Ue,10),f(si,10),f(He,10),f(Rr,8))},e.\u0275dir=M({type:e,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[K([zs]),G,ve]});let n=e;return n})(),qs={provide:He,useExisting:ie(()=>Me),multi:!0};function Vr(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function Ks(n){return n.split(":")[0]}var Me=(()=>{let e=class e extends kt{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;let r=this._getOptionId(t),s=Vr(r,t);this.setProperty("value",s)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){let r=Ks(t);return this._optionMap.has(r)?this._optionMap.get(r):t}};e.\u0275fac=(()=>{let t;return function(s){return(t||(t=me(e)))(s||e)}})(),e.\u0275dir=M({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,s){r&1&&y("change",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[K([qs]),G]});let n=e;return n})(),ct=(()=>{let e=class e{constructor(t,r,s){this._element=t,this._renderer=r,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(t){this._select!=null&&(this._select._optionMap.set(this.id,t),this._setElementValue(Vr(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(r){return new(r||e)(f(re),f(ft),f(Me,9))},e.\u0275dir=M({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})(),Qs={provide:He,useExisting:ie(()=>Nr),multi:!0};function ur(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function Zs(n){return n.split(":")[0]}var Nr=(()=>{let e=class e extends kt{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;let r;if(Array.isArray(t)){let s=t.map(o=>this._getOptionId(o));r=(o,a)=>{o._setSelected(s.indexOf(a.toString())>-1)}}else r=(s,o)=>{s._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{let s=[],o=r.selectedOptions;if(o!==void 0){let a=o;for(let u=0;u<a.length;u++){let h=a[u],g=this._getOptionValue(h.value);s.push(g)}}else{let a=r.options;for(let u=0;u<a.length;u++){let h=a[u];if(h.selected){let g=this._getOptionValue(h.value);s.push(g)}}}this.value=s,t(s)}}_registerOption(t){let r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){let r=Zs(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}};e.\u0275fac=(()=>{let t;return function(s){return(t||(t=me(e)))(s||e)}})(),e.\u0275dir=M({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,s){r&1&&y("change",function(a){return s.onChange(a.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[K([Qs]),G]});let n=e;return n})(),lt=(()=>{let e=class e{constructor(t,r,s){this._element=t,this._renderer=r,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){this._select!=null&&(this._value=t,this._setElementValue(ur(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(ur(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(r){return new(r||e)(f(re),f(ft),f(Nr,9))},e.\u0275dir=M({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})();function Ys(n){return typeof n=="number"?n:parseInt(n,10)}var on=(()=>{let e=class e{constructor(){this._validator=Yt}ngOnChanges(t){if(this.inputName in t){let r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):Yt,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=M({type:e,features:[ve]});let n=e;return n})();var Js={provide:Ue,useExisting:ie(()=>We),multi:!0};var We=(()=>{let e=class e extends on{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=bt,this.createValidator=t=>fr}enabled(t){return t}};e.\u0275fac=(()=>{let t;return function(s){return(t||(t=me(e)))(s||e)}})(),e.\u0275dir=M({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,s){r&2&&Ne("required",s._enabled?"":null)},inputs:{required:"required"},features:[K([Js]),G]});let n=e;return n})();var Xs={provide:Ue,useExisting:ie(()=>Tt),multi:!0},Tt=(()=>{let e=class e extends on{constructor(){super(...arguments),this.inputName="minlength",this.normalizeInput=t=>Ys(t),this.createValidator=t=>gr(t)}};e.\u0275fac=(()=>{let t;return function(s){return(t||(t=me(e)))(s||e)}})(),e.\u0275dir=M({type:e,selectors:[["","minlength","","formControlName",""],["","minlength","","formControl",""],["","minlength","","ngModel",""]],hostVars:1,hostBindings:function(r,s){r&2&&Ne("minlength",s._enabled?s.minlength:null)},inputs:{minlength:"minlength"},features:[K([Xs]),G]});let n=e;return n})();var eo={provide:Ue,useExisting:ie(()=>an),multi:!0},an=(()=>{let e=class e extends on{constructor(){super(...arguments),this.inputName="pattern",this.normalizeInput=t=>t,this.createValidator=t=>br(t)}};e.\u0275fac=(()=>{let t;return function(s){return(t||(t=me(e)))(s||e)}})(),e.\u0275dir=M({type:e,selectors:[["","pattern","","formControlName",""],["","pattern","","formControl",""],["","pattern","","ngModel",""]],hostVars:1,hostBindings:function(r,s){r&2&&Ne("pattern",s._enabled?s.pattern:null)},inputs:{pattern:"pattern"},features:[K([eo]),G]});let n=e;return n})();var Lr=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=j({type:e}),e.\u0275inj=L({});let n=e;return n})(),Zi=class extends rt{constructor(e,i,t){super(en(i),tn(t,i)),this.controls=e,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,i={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}insert(e,i,t={}){this.controls.splice(e,0,i),this._registerControl(i),this.updateValueAndValidity({emitEvent:t.emitEvent})}removeAt(e,i={}){let t=this._adjustIndex(e);t<0&&(t=0),this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),this.updateValueAndValidity({emitEvent:i.emitEvent})}setControl(e,i,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),i&&(this.controls.splice(r,0,i),this._registerControl(i)),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,i={}){Er(this,!1,e),e.forEach((t,r)=>{Tr(this,!1,r),this.at(r).setValue(t,{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(e,i={}){e!=null&&(e.forEach((t,r)=>{this.at(r)&&this.at(r).patchValue(t,{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(e=[],i={}){this._forEachChild((t,r)=>{t.reset(e[r],{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i,this),this._updateTouched(i,this),this.updateValueAndValidity(i)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(i=>i._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((i,t)=>t._syncPendingControls()?!0:i,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((i,t)=>{e(i,t)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(i=>i.enabled&&e(i))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function hr(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var jr=(()=>{let e=class e{constructor(){this.useNonNullable=!1}get nonNullable(){let t=new e;return t.useNonNullable=!0,t}group(t,r=null){let s=this._reduceControls(t),o={};return hr(r)?o=r:r!==null&&(o.validators=r.validator,o.asyncValidators=r.asyncValidator),new st(s,o)}record(t,r=null){let s=this._reduceControls(t);return new Qi(s,r)}control(t,r,s){let o={};return this.useNonNullable?(hr(r)?o=r:(o.validators=r,o.asyncValidators=s),new It(t,ce(U({},o),{nonNullable:!0}))):new It(t,r,s)}array(t,r,s){let o=t.map(a=>this._createControl(a));return new Zi(o,r,s)}_reduceControls(t){let r={};return Object.keys(t).forEach(s=>{r[s]=this._createControl(t[s])}),r}_createControl(t){if(t instanceof It)return t;if(t instanceof rt)return t;if(Array.isArray(t)){let r=t[0],s=t.length>1?t[1]:null,o=t.length>2?t[2]:null;return this.control(r,s,o)}else return this.control(t)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Br=(()=>{let e=class e{static withConfig(t){return{ngModule:e,providers:[{provide:xt,useValue:t.callSetDisabledState??ai}]}}};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=j({type:e}),e.\u0275inj=L({imports:[Lr]});let n=e;return n})(),Hr=(()=>{let e=class e{static withConfig(t){return{ngModule:e,providers:[{provide:Rr,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:xt,useValue:t.callSetDisabledState??ai}]}}};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=j({type:e}),e.\u0275inj=L({imports:[Lr]});let n=e;return n})();var ci=class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=k({type:n,selectors:[["app-basic"]],decls:9,vars:0,consts:[["routerLink","/ngr-basic/tva"],["routerLink","/ngr-basic/calculatrice/simple"],["routerLink","/ngr-basic/calculatrice/sophistiquee"]],template:function(i,t){i&1&&(d(0,"a",0),l(1,"tva"),c(),l(2," \xA0 "),d(3,"a",1),l(4,"calculatrice simple"),c(),_(5,"br"),d(6,"a",2),l(7,"calculatrice sophistiquee"),c(),_(8,"router-outlet"))},dependencies:[Kt,tt]})};var li=class n{a=0;b=0;res=0;modeChoisi="simple";constructor(e){e.params.subscribe(i=>{this.modeChoisi=i.mode})}onCalculer(e){switch(e){case"+":this.res=Number(this.a)+Number(this.b);break;case"-":this.res=this.a-this.b;break;case"*":this.res=this.a*this.b;break;case"/":this.res=this.a/this.b;break;default:this.res=0}}x=0;y=0;onMouseMove(e){let i=e.target;this.x=e.pageX-i.offsetLeft,this.y=e.pageY-i.offsetTop}onMouseLeave(e){this.x=0,this.y=0}static \u0275fac=function(i){return new(i||n)(f(nr))};static \u0275cmp=k({type:n,selectors:[["app-calculatrice"]],decls:34,vars:15,consts:[["aCtrl","ngModel"],["type","number","name","a","required","",3,"ngModelChange","ngModel"],[3,"hidden"],["type","number","name","b","required","",3,"ngModelChange","ngModel"],[3,"click"],["id","spanRes"],[1,"c2",3,"mousemove","mouseout"]],template:function(i,t){if(i&1){let r=le();d(0,"p"),l(1,"calculatrice"),c(),d(2,"label"),l(3,"a:"),c(),d(4,"input",1,0),R("ngModelChange",function(o){return E(r),O(t.a,o)||(t.a=o),D(o)}),c(),d(6,"div",2),l(7),je(8,"json"),c(),_(9,"br"),d(10,"label"),l(11,"b:"),c(),d(12,"input",3),R("ngModelChange",function(o){return E(r),O(t.b,o)||(t.b=o),D(o)}),c(),_(13,"br"),d(14,"button",4),y("click",function(){return E(r),D(t.onCalculer("+"))}),l(15,"+"),c(),l(16,` \xA0
`),d(17,"button",4),y("click",function(){return E(r),D(t.onCalculer("-"))}),l(18,"-"),c(),l(19,` \xA0
`),d(20,"button",4),y("click",function(){return E(r),D(t.onCalculer("*"))}),l(21,"*"),c(),l(22,` \xA0
`),d(23,"button",4),y("click",function(){return E(r),D(t.onCalculer("/"))}),l(24,"/"),c(),_(25,"br"),l(26,`
res= `),d(27,"span",5),l(28),c(),_(29,"hr"),d(30,"div",6),y("mousemove",function(o){return E(r),D(t.onMouseMove(o))})("mouseout",function(o){return E(r),D(t.onMouseLeave(o))}),l(31," Zone \xE0 survoler \xE0 la souris ."),_(32,"br"),l(33),c()}if(i&2){let r=Le(5);m(4),P("ngModel",t.a),m(2),S("hidden",r.valid),m(),A(Wn(8,13,r.errors)),m(5),P("ngModel",t.b),m(8),q("visibility",t.modeChoisi=="simple"?"hidden":"visible"),m(7),q("font-weight",t.res>0?"bold":"normal"),se("negatif",t.res<0),m(),A(t.res),m(5),Un(" x=",t.x," , y=",t.y," ")}},dependencies:[Q,Ie,Z,We,X,qn]})};var di=class n{constructor(){}calculTva(e,i){return e*i/100}addition(e,i){return Number(e)+Number(i)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})};var ui=class n{transform(e,...i){let t=e,r=i[0]||"1.0-2",s=Number(r.split("-")[1]);return t.toFixed(s)}static \u0275fac=function(i){return new(i||n)};static \u0275pipe=Vn({name:"mynumber",type:n,pure:!0})};function no(n,e){if(n&1&&(d(0,"option",8),l(1),c()),n&2){let i=e.$implicit;S("ngValue",i),m(),H("",i,"%")}}function ro(n,e){if(n&1&&(d(0,"div"),l(1," tva="),d(2,"span",9),l(3),je(4,"mynumber"),c(),_(5,"br"),l(6,`
ttc=`),d(7,"span",10),l(8),je(9,"mynumber"),c(),_(10,"br"),c()),n&2){let i=oe();m(3),A(gt(4,2,i.tva,"1.0-2")),m(5),A(gt(9,5,i.ttc,"1.0-2"))}}function so(n,e){if(n&1){let i=le();d(0,"li",11),y("click",function(){let r=E(i).$implicit,s=oe();return D(s.onSelectTaux(r))}),l(1),c()}if(n&2){let i=e.$implicit,t=oe();se("enEvidence",i===t.tauxSel),m(),H("",i,"%")}}var hi=class n{constructor(e){this._calculService=e;this.mapTauxCategorieProd.set(20,["services","outils","objets"]),this.mapTauxCategorieProd.set(10,["transports","hotels","restaurants","spectacles","m\xE9dicaments"]),this.mapTauxCategorieProd.set(5,["aliments","\xE9nergies","livres"])}listeTaux=[5,10,20];ht=0;taux=20;tva=0;ttc=0;onCalculerTvaTtc(){this.tva=this._calculService.calculTva(this.ht,this.taux),this.ttc=this._calculService.addition(this.tva,this.ht)}mapTauxCategorieProd=new Map;tauxSel=void 0;listeCategoriePourTauxSel=[];onSelectTaux(e){this.tauxSel=e,this.listeCategoriePourTauxSel=this.mapTauxCategorieProd.get(e)??[]}static \u0275fac=function(i){return new(i||n)(f(di))};static \u0275cmp=k({type:n,selectors:[["app-tva"]],decls:24,vars:6,consts:[["name","ht","type","number",3,"input","ngModelChange","ngModel"],["name","taux",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"myFlexRow"],[1,"myFlexCell"],[3,"enEvidence","click",4,"ngFor","ngForOf"],[1,"enEvidence"],[3,"ngValue"],["id","spanTva",1,"enEvidence"],["id","spanTtc",1,"enEvidence"],[3,"click"]],template:function(i,t){i&1&&(d(0,"p"),l(1,"calcul tva"),c(),d(2,"label"),l(3,"ht:"),c(),d(4,"input",0),y("input",function(){return t.onCalculerTvaTtc()}),R("ngModelChange",function(s){return O(t.ht,s)||(t.ht=s),s}),c(),_(5,"br"),d(6,"label"),l(7,"tauxTva(%):"),c(),d(8,"select",1),R("ngModelChange",function(s){return O(t.taux,s)||(t.taux=s),s}),y("change",function(){return t.onCalculerTvaTtc()}),B(9,no,2,2,"option",2),c(),_(10,"br"),B(11,ro,11,8,"div",3),_(12,"hr"),d(13,"div",4)(14,"div",5)(15,"h6"),l(16,"principaux taux de tva:"),c(),d(17,"ul"),B(18,so,2,3,"li",6),c()(),d(19,"div",5)(20,"h6"),l(21,"principales cat\xE9gories pour le taux s\xE9lectionn\xE9:"),c(),d(22,"p",7),l(23),c()()()),i&2&&(m(4),P("ngModel",t.ht),m(4),P("ngModel",t.taux),m(),S("ngForOf",t.listeTaux),m(2),S("ngIf",t.ht>0),m(7),S("ngForOf",t.listeTaux),m(5),A(t.listeCategoriePourTauxSel))},dependencies:[de,Je,ct,lt,Q,Ie,Me,Z,X,ui],styles:[".myFlexRow[_ngcontent-%COMP%]{width:100%;display:flex;flex-flow:row nowrap}.myFlexCell[_ngcontent-%COMP%]{flex:1 1 auto;text-align:left;padding:2px}.enEvidence[_ngcontent-%COMP%]{color:#00f;font-weight:700}"]})};function Ge(n,e=""){let i="";if(n.error instanceof Error)console.log("Client-side error occured."+JSON.stringify(n)),i=e;else{console.log("Server-side error occured : "+JSON.stringify(n));let t=n.error&&n.error.message?":"+n.error.message:"";i=e+" (status="+n.status+":"+n.statusText+") "+t}return i}function Et(n,e=""){return n instanceof Qn?Ge(n,e):JSON.stringify(n)}var ut=class n{constructor(e){this.http=e}_withoutSecurity=!1;set withoutSecurity(e){this._withoutSecurity=e,this.publicOrPrivateBaseUrl=this._withoutSecurity?this.publicBaseUrl:this.privateBaseUrl}get withoutSecurity(){return this._withoutSecurity}_apiBaseUrl="/tp/devise-api/v1";publicBaseUrl=`${this._apiBaseUrl}/public`;privateBaseUrl=`${this._apiBaseUrl}/private`;publicOrPrivateBaseUrl=this.privateBaseUrl;getAllDevises$(){let e=`${this.publicBaseUrl}/devises`;return console.log("url = "+e),this.http.get(e).pipe(W(i=>i.sort((t,r)=>t?t.code.localeCompare(r.code):0)))}getDeviseByCode$(e){let i=`${this.publicBaseUrl}/devises/${e}`;return console.log("url = "+i),this.http.get(i)}deleteDevise$(e){let i=`${this.publicOrPrivateBaseUrl}/devises/${e}?v=true`;return console.log("deleteUrl="+i),this.http.delete(i)}postDevise$(e){let i=`${this.publicOrPrivateBaseUrl}/devises`;return this.http.post(i,e)}putDevise$(e){let i=e.code,t=`${this.publicOrPrivateBaseUrl}/devises/${i}?v=true`;return this.http.put(t,e)}convertir$(e,i,t){let r=this.publicBaseUrl+`/convert?source=${i}&target=${t}&amount=${e}`;return console.log("url="+r),this.http.get(r).pipe(W(s=>s.result))}static \u0275fac=function(i){return new(i||n)(C(et))};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})};function oo(n,e){if(n&1&&(d(0,"option"),l(1),c()),n&2){let i=e.$implicit;m(),A(i.code)}}function ao(n,e){if(n&1&&(d(0,"option"),l(1),c()),n&2){let i=e.$implicit;m(),A(i.code)}}var mi=class n{constructor(e){this._deviseService=e}platform=ne(Se);montant=0;codeDeviseSource="?";codeDeviseCible="?";montantConverti=0;message="";codeToUpdate="?";changeToUpdate=1;listeDevises=[];onConvertir(){console.log("debut de onConvertir"),this._deviseService.convertir$(this.montant,this.codeDeviseSource,this.codeDeviseCible).subscribe({next:e=>{this.montantConverti=e,console.log("resultat obtenu en diff\xE9r\xE9")},error:e=>{console.log("error:"+e),this.message=Ge(e,"echec convertir")}}),console.log("suite imm\xE9diate (sans attente) de onConvertir")}onConvertirV2(){return z(this,null,function*(){try{this.montantConverti=yield ge(this._deviseService.convertir$(this.montant,this.codeDeviseSource,this.codeDeviseCible))}catch(e){console.log(e),this.message=e}})}onUpdate(){return z(this,null,function*(){try{let e,i;for(e of this.listeDevises)e.code==this.codeToUpdate&&(i=JSON.parse(JSON.stringify(e)));i==null?this.message="pas de devise pour ce code":(i.change=this.changeToUpdate,yield ge(this._deviseService.putDevise$(i)),this.message="mise \xE0 jour ok")}catch(e){console.log(e),this.message=JSON.stringify(e)}})}initListeDevises(e){this.listeDevises=e,e&&e.length>0&&(this.codeDeviseSource=e[0].code,this.codeDeviseCible=e[0].code)}ngOnInit(){Ce(this.platform)&&this._deviseService.getAllDevises$().subscribe({next:e=>{this.initListeDevises(e)},error:e=>{console.log("error:"+e)}})}static \u0275fac=function(i){return new(i||n)(f(ut))};static \u0275cmp=k({type:n,selectors:[["app-conversion"]],decls:30,vars:9,consts:[[3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"],["type","button","value","convertir",3,"click"],[3,"click"]],template:function(i,t){i&1&&(d(0,"h3"),l(1,"conversion de devise"),c(),l(2,`
montant : `),d(3,"input",0),R("ngModelChange",function(s){return O(t.montant,s)||(t.montant=s),s}),c(),_(4,"br"),l(5,`
code devise source : `),d(6,"select",0),R("ngModelChange",function(s){return O(t.codeDeviseSource,s)||(t.codeDeviseSource=s),s}),B(7,oo,2,1,"option",1),c(),_(8,"br"),l(9,`
code devise cible : `),d(10,"select",0),R("ngModelChange",function(s){return O(t.codeDeviseCible,s)||(t.codeDeviseCible=s),s}),B(11,ao,2,1,"option",1),c(),_(12,"br"),d(13,"input",2),y("click",function(){return t.onConvertirV2()}),c(),_(14,"br"),l(15),_(16,"br")(17,"hr"),l(18),_(19,"hr"),l(20,`
code devise a modifier: `),d(21,"input",0),R("ngModelChange",function(s){return O(t.codeToUpdate,s)||(t.codeToUpdate=s),s}),c(),l(22," (ex: JPY , GBP, ...) "),_(23,"br"),l(24,`
nouveau change: `),d(25,"input",0),R("ngModelChange",function(s){return O(t.changeToUpdate,s)||(t.changeToUpdate=s),s}),c(),l(26," (ex: 0.9 , 1.1 ) "),_(27,"br"),d(28,"button",3),y("click",function(){return t.onUpdate()}),l(29,"update devise"),c()),i&2&&(m(3),P("ngModel",t.montant),m(3),P("ngModel",t.codeDeviseSource),m(),S("ngForOf",t.listeDevises),m(3),P("ngModel",t.codeDeviseCible),m(),S("ngForOf",t.listeDevises),m(4),H(`
montantConverti = `,t.montantConverti," "),m(3),H(`
`,t.message,`
`),m(3),P("ngModel",t.codeToUpdate),m(4),P("ngModel",t.changeToUpdate))},dependencies:[de,ct,lt,Q,Me,Z,X]})};var Oe=class n{bsSeuilMaxi=new Vt(100);changerSeuil(e){this.bsSeuilMaxi.next(e)}get seuilMaxiObservable(){return this.bsSeuilMaxi}tabProduit=[{numero:5,label:"produit 5",prix:120},{numero:1,label:"produit 1",prix:50},{numero:2,label:"produit 2",prix:30},{numero:3,label:"produit 3",prix:80},{numero:4,label:"produit 4",prix:500},{numero:6,label:"produit 6",prix:20}];rechercherNombreProduitSimu$(e){return this.rechercherProduitSimu$(e).pipe(W(i=>i.length))}rechercherProduitSimu$(e){return J(this.tabProduit).pipe(Bt(i=>i),W(i=>(i.label=i.label.toUpperCase(),i)),te(i=>i.prix<=e),Mn(),W(i=>i.sort((t,r)=>t.prix-r.prix)))}constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})};var pi=class n{width="100";changeEvent=new pe;onCurseur(e){let r=e.offsetX/Number(this.width)*100;this.changeEvent.emit({value:r})}constructor(){}ngOnInit(){}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=k({type:n,selectors:[["app-reglette"]],inputs:{width:"width"},outputs:{changeEvent:"changeEvent"},decls:1,vars:2,consts:[[1,"reglette",3,"click"]],template:function(i,t){i&1&&(d(0,"div",0),y("click",function(s){return t.onCurseur(s)}),c()),i&2&&q("width",t.width,"px")},styles:[".reglette[_ngcontent-%COMP%]{width:100px;height:40px;background:linear-gradient(to right,#fff,#00f);border-style:solid;border-width:2px;border-color:#00f}"]})};var fi=class n{constructor(e){this._produitService=e}seuilMax=100;onSeuilChange(){this._produitService.changerSeuil(this.seuilMax)}ngOnInit(){}static \u0275fac=function(i){return new(i||n)(f(Oe))};static \u0275cmp=k({type:n,selectors:[["app-seuil"]],decls:3,vars:1,consts:[["type","number",3,"ngModelChange","ngModel"]],template:function(i,t){i&1&&(d(0,"label"),l(1,"seuilMax"),c(),d(2,"input",0),R("ngModelChange",function(s){return O(t.seuilMax,s)||(t.seuilMax=s),s}),y("ngModelChange",function(){return t.onSeuilChange()}),c()),i&2&&(m(2),P("ngModel",t.seuilMax))},dependencies:[Q,Ie,Z,X]})};function uo(n,e){if(n&1&&(d(0,"tr")(1,"td"),l(2),c(),d(3,"td"),l(4),c(),d(5,"td"),l(6),c()()),n&2){let i=e.$implicit;m(2),A(i.numero),m(2),A(i.label),m(2),A(i.prix)}}var gi=class n{constructor(e){this._produitService=e;this._produitService.seuilMaxiObservable.subscribe(i=>this.actualiserListeProduitSelonSeuilMaxi(i))}listeProduits=[];actualiserListeProduitSelonSeuilMaxi(e){this._produitService.rechercherProduitSimu$(e).subscribe(i=>{this.listeProduits=i})}ngOnInit(){}static \u0275fac=function(i){return new(i||n)(f(Oe))};static \u0275cmp=k({type:n,selectors:[["app-list-prod"]],decls:11,vars:1,consts:[["border","1"],[4,"ngFor","ngForOf"]],template:function(i,t){i&1&&(d(0,"p"),l(1,"list-prod "),c(),d(2,"table",0)(3,"tr")(4,"th"),l(5,"numero"),c(),d(6,"th"),l(7,"label"),c(),d(8,"th"),l(9,"prix"),c()(),B(10,uo,7,3,"tr",1),c()),i&2&&(m(10),S("ngForOf",t.listeProduits))},dependencies:[de]})};function mo(n,e){if(n&1){let i=le();d(0,"li",4),y("click",function(){let r=E(i).$implicit,s=oe();return D(s.onSelectCategorie(r))}),l(1),c()}if(n&2){let i=e.$implicit,t=oe();se("selected",i==t.categorie),m(),A(i)}}function po(n,e){if(n&1&&(d(0,"tr")(1,"td"),l(2),c(),d(3,"td"),l(4),c(),d(5,"td"),l(6),c()()),n&2){let i=e.$implicit;m(2),A(i.ref),m(2),A(i.label),m(2),A(i.prix)}}function fo(n,e){if(n&1&&(d(0,"div",1)(1,"h3"),l(2),c(),d(3,"table",5)(4,"tr")(5,"th"),l(6,"ref"),c(),d(7,"th"),l(8,"label"),c(),d(9,"th"),l(10,"prix"),c()(),B(11,po,7,3,"tr",6),c()()),n&2){let i=oe();m(2),H("produits de la cat\xE9gorie ",i.categorie," :"),m(9),S("ngForOf",i.listeProduits)}}var Re=class{constructor(e="?",i="?",t=0){this.ref=e;this.label=i;this.prix=t}},bi=class n{listeCategories=["cd","dvd","other"];categorie;mapCategorieProduits=new Map;listeProduits;onSelectCategorie(e){this.categorie=e,console.log("categorieChoisie="+this.categorie),this.listeProduits=this.mapCategorieProduits.get(this.categorie),console.log("listeProduits="+JSON.stringify(this.listeProduits))}constructor(){this.mapCategorieProduits.set("cd",[new Re("p1","CD1",5.6),new Re("p2","CD2",9.6)]),this.mapCategorieProduits.set("dvd",[new Re("p3","DVD a",15.6),new Re("p4","DVD b",19.6)]),this.mapCategorieProduits.set("other",[new Re("p5","smartPhone",255.6),new Re("p6","TV",567.6)])}ngOnInit(){}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=k({type:n,selectors:[["app-zz"]],decls:8,vars:2,consts:[[1,"myWrapFlexbox"],[1,"myColItem"],[3,"selected","click",4,"ngFor","ngForOf"],["class","myColItem",4,"ngIf"],[3,"click"],["border","1"],[4,"ngFor","ngForOf"]],template:function(i,t){i&1&&(d(0,"div",0)(1,"div",1)(2,"h3"),l(3,"cat\xE9gorie \xE0 selectionner:"),c(),d(4,"ul"),B(5,mo,2,3,"li",2),c(),_(6,"br"),c(),B(7,fo,12,2,"div",3),c()),i&2&&(m(5),S("ngForOf",t.listeCategories),m(2),S("ngIf",t.categorie))},dependencies:[de,Je],styles:[".selected[_ngcontent-%COMP%]{color:#00f;font-weight:700}.myWrapFlexbox[_ngcontent-%COMP%]{padding:1em;display:flex;flex-flow:row wrap}.myColItem[_ngcontent-%COMP%]{flex:1 1 auto;text-align:left;padding:2px;margin:8px}"]})};var _i=class n{constructor(e){this.produitService=e;this.produitService.seuilMaxiObservable.subscribe(i=>{this.actualiserNbProd(i)})}valeurCurseur=0;onChangeCurseur(e){let i=e;this.valeurCurseur=i.value}nbProdPrixInferieurSeuilMaxi=0;actualiserNbProd(e){this.produitService.rechercherNombreProduitSimu$(e).subscribe(i=>{this.nbProdPrixInferieurSeuilMaxi=i})}ngOnInit(){}static \u0275fac=function(i){return new(i||n)(f(Oe))};static \u0275cmp=k({type:n,selectors:[["app-demo"]],decls:10,vars:2,consts:[["width","200",3,"changeEvent"]],template:function(i,t){i&1&&(_(0,"app-seuil"),d(1,"p"),l(2),c(),_(3,"hr")(4,"app-list-prod")(5,"hr"),d(6,"app-reglette",0),y("changeEvent",function(s){return t.onChangeCurseur(s)}),c(),l(7),_(8,"hr")(9,"app-zz")),i&2&&(m(2),H("nbProd : ",t.nbProdPrixInferieurSeuilMaxi,""),m(5),H(" curseur = ",t.valeurCurseur,`
`))},dependencies:[pi,fi,gi,bi]})};var vi=class n{set borderColor(e){e!=""&&(this._borderColor=e)}_borderColor="red";_borderStyle="hidden";constructor(e){e.nativeElement.style._borderWidth="2px"}onMouseEnter(){this._borderStyle="solid"}onMouseLeave(){this._borderStyle="hidden"}static \u0275fac=function(i){return new(i||n)(f(re))};static \u0275dir=M({type:n,selectors:[["","borderOver",""]],hostVars:4,hostBindings:function(i,t){i&1&&y("mouseenter",function(){return t.onMouseEnter()})("mouseleave",function(){return t.onMouseLeave()}),i&2&&q("border-color",t._borderColor)("border-style",t._borderStyle)},inputs:{borderColor:[0,"borderOver","borderColor"]}})};var yi=class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=k({type:n,selectors:[["app-welcome"]],decls:7,vars:0,consts:[[2,"min-height","80px"],["borderOver","blue","src","favicon.ico"],["borderOver","","src","favicon.ico"],["borderOver","green","src","favicon.ico"]],template:function(i,t){i&1&&(d(0,"h2"),l(1,"welcome to angular app"),c(),_(2,"hr"),d(3,"div",0),_(4,"img",1)(5,"img",2)(6,"img",3),c())},dependencies:[vi]})};var Gr=(n,e)=>{let i=sessionStorage.getItem("access_token");return console.log("authGardGuard with token="+i),i!=null&&i!=""&&i!="null"?!0:J(ir(n,["../ngr-login"]))};var Ci=class{constructor(e="",i="",t=""){this.username=e;this.password=i;this.roles=t}};var ke=class{constructor(e="?",i=!1,t="?",r=[]){this.username=e;this.authenticated=i;this.roles=t;this.grantedScopes=r}};var wi=class n{constructor(e){this.http=e}baseUrl="/tp/standalone-login-api/v1/public";postLogin$(e){let i=this.baseUrl+"/auth";return this.http.post(i,e)}static \u0275fac=function(i){return new(i||n)(C(et))};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})};var _e=class n{bsUserInSession=new Vt(new ke);get userInSession$(){return this.bsUserInSession}set userInSession$(e){this.bsUserInSession.next(e)}constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})};var ki=class n{constructor(e,i,t){this.loginService=e;this._sessionService=i;this.router=t}login=new Ci("user1","pwd1","user");message="";status=!1;onLoginV1(){this.loginService.postLogin$(this.login).subscribe({next:e=>{this.message=e.message,this.status=e.status},error:e=>{console.log("error:"+e),this.message=Ge(e,"echec login")}})}onLogin(){return z(this,null,function*(){sessionStorage.setItem("access_token","");try{let e=yield ge(this.loginService.postLogin$(this.login));console.log("loginResponse="+JSON.stringify(e)),this.message=e.message,this.status=e.status,sessionStorage.setItem("access_token",e.token),e.status==!0?this._sessionService.userInSession$=new ke(e.username,!0,"?",[]):this._sessionService.userInSession$=new ke("?",!1,"?",[])}catch(e){console.log("error:"+e),this.message="echec login"}})}static \u0275fac=function(i){return new(i||n)(f(wi),f(_e),f(Qt))};static \u0275cmp=k({type:n,selectors:[["app-login"]],decls:29,vars:7,consts:[["formLogin","ngForm"],["usernameCtrl","ngModel"],[1,"form-group","row"],[1,"col-sm-3"],[1,"col-sm-9"],["name","username","required","","pattern","^[a-zA-Z].+",1,"form-control",3,"ngModelChange","ngModel"],["name","password","required","","minlength","3",1,"form-control",3,"ngModelChange","ngModel"],["name","roles","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-sm-9","offset-3"],[1,"btn","btn-primary",3,"click","disabled"],[1,"badge","badge-primary"],[1,"bi","bi-person"]],template:function(i,t){if(i&1){let r=le();d(0,"p"),l(1,"login"),c(),d(2,"form",null,0)(4,"div",2)(5,"label",3),l(6,"username:"),c(),d(7,"div",4)(8,"input",5,1),R("ngModelChange",function(o){return E(r),O(t.login.username,o)||(t.login.username=o),D(o)}),c()()(),d(10,"div",2)(11,"label",3),l(12,"password:"),c(),d(13,"div",4)(14,"input",6),R("ngModelChange",function(o){return E(r),O(t.login.password,o)||(t.login.password=o),D(o)}),c()()(),d(15,"div",2)(16,"label",3),l(17,"roles:"),c(),d(18,"div",4)(19,"input",7),R("ngModelChange",function(o){return E(r),O(t.login.roles,o)||(t.login.roles=o),D(o)}),c()()(),d(20,"div",2)(21,"div",8)(22,"button",9),y("click",function(){return E(r),D(t.onLogin())}),l(23,"submit/login "),d(24,"span",10),_(25,"i",11),c()()()()(),d(26,"span"),l(27),c(),_(28,"br")}if(i&2){let r=Le(3);m(8),P("ngModel",t.login.username),m(6),P("ngModel",t.login.password),m(5),P("ngModel",t.login.roles),m(3),S("disabled",!r.form.valid),m(4),q("color",t.status?"green":"red"),m(),A(t.message)}},dependencies:[at,Q,Z,ot,We,Tt,an,X,St]})};var xi=class{validateSignature(e){return Promise.resolve(null)}validateAtHash(e){return Promise.resolve(!0)}},Si=class{};var Dt=class{},vo=(()=>{let e=class e extends Dt{now(){return Date.now()}new(){return new Date}};e.\u0275fac=(()=>{let t;return function(s){return(t||(t=me(e)))(s||e)}})(),e.\u0275prov=I({token:e,factory:e.\u0275fac});let n=e;return n})();var Ti=class{},Ei=class{},yo=(()=>{let e=class e{constructor(){this.data=new Map}getItem(t){return this.data.get(t)}removeItem(t){this.data.delete(t)}setItem(t,r){this.data.set(t,r)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=I({token:e,factory:e.\u0275fac});let n=e;return n})();var At=class{constructor(e){this.type=e}},$=class extends At{constructor(e,i=null){super(e),this.info=i}},ae=class extends At{constructor(e,i=null){super(e),this.info=i}},V=class extends At{constructor(e,i,t=null){super(e),this.reason=i,this.params=t}};function $r(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(e).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function zr(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var ht=class{constructor(e){this.clientId="",this.redirectUri="",this.postLogoutRedirectUri="",this.redirectUriAsPostLogoutRedirectUriFallback=!0,this.loginUrl="",this.scope="openid profile",this.resource="",this.rngUrl="",this.oidc=!0,this.requestAccessToken=!0,this.options=null,this.issuer="",this.logoutUrl="",this.clearHashAfterLogin=!0,this.tokenEndpoint=null,this.revocationEndpoint=null,this.customTokenParameters=[],this.userinfoEndpoint=null,this.responseType="",this.showDebugInformation=!1,this.silentRefreshRedirectUri="",this.silentRefreshMessagePrefix="",this.silentRefreshShowIFrame=!1,this.siletRefreshTimeout=1e3*20,this.silentRefreshTimeout=1e3*20,this.dummyClientSecret="",this.requireHttps="remoteOnly",this.strictDiscoveryDocumentValidation=!0,this.jwks=null,this.customQueryParams=null,this.silentRefreshIFrameName="angular-oauth-oidc-silent-refresh-iframe",this.timeoutFactor=.75,this.sessionChecksEnabled=!1,this.sessionCheckIntervall=3*1e3,this.sessionCheckIFrameUrl=null,this.sessionCheckIFrameName="angular-oauth-oidc-check-session-iframe",this.disableAtHashCheck=!1,this.skipSubjectCheck=!1,this.useIdTokenHintForSilentRefresh=!1,this.skipIssuerCheck=!1,this.nonceStateSeparator=";",this.useHttpBasicAuth=!1,this.decreaseExpirationBySec=0,this.waitForTokenInMsec=0,this.disablePKCE=!1,this.preserveRequestedRoute=!1,this.disableIdTokenTimer=!1,this.checkOrigin=!1,this.openUri=i=>{location.href=i},e&&Object.assign(this,e)}},$e=class{encodeKey(e){return encodeURIComponent(e)}encodeValue(e){return encodeURIComponent(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}},Di=class{};var qr=(()=>{let e=class e{getHashFragmentParams(t){let r=t||window.location.hash;if(r=decodeURIComponent(r),r.indexOf("#")!==0)return{};let s=r.indexOf("?");return s>-1?r=r.substr(s+1):r=r.substr(1),this.parseQueryString(r)}parseQueryString(t){let r={},s,o,a,u,h,g;if(t===null)return r;let T=t.split("&");for(let p=0;p<T.length;p++)s=T[p],o=s.indexOf("="),o===-1?(a=s,u=null):(a=s.substr(0,o),u=s.substr(o+1)),h=decodeURIComponent(a),g=decodeURIComponent(u),h.substr(0,1)==="/"&&(h=h.substr(1)),r[h]=g;return r}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=I({token:e,factory:e.\u0275fac});let n=e;return n})(),Kr=32,Co=64,wo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function ln(n,e,i,t,r){let s,o,a,u,h,g,T,p,v,b,F,N,fe;for(;r>=64;){for(s=e[0],o=e[1],a=e[2],u=e[3],h=e[4],g=e[5],T=e[6],p=e[7],b=0;b<16;b++)F=t+b*4,n[b]=(i[F]&255)<<24|(i[F+1]&255)<<16|(i[F+2]&255)<<8|i[F+3]&255;for(b=16;b<64;b++)v=n[b-2],N=(v>>>17|v<<15)^(v>>>19|v<<13)^v>>>10,v=n[b-15],fe=(v>>>7|v<<25)^(v>>>18|v<<14)^v>>>3,n[b]=(N+n[b-7]|0)+(fe+n[b-16]|0);for(b=0;b<64;b++)N=(((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&g^~h&T)|0)+(p+(wo[b]+n[b]|0)|0)|0,fe=((s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+(s&o^s&a^o&a)|0,p=T,T=g,g=h,h=u+N|0,u=a,a=o,o=s,s=N+fe|0;e[0]+=s,e[1]+=o,e[2]+=a,e[3]+=u,e[4]+=h,e[5]+=g,e[6]+=T,e[7]+=p,t+=64,r-=64}return t}var dn=class{constructor(){this.digestLength=Kr,this.blockSize=Co,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}reset(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this}clean(){for(let e=0;e<this.buffer.length;e++)this.buffer[e]=0;for(let e=0;e<this.temp.length;e++)this.temp[e]=0;this.reset()}update(e,i=e.length){if(this.finished)throw new Error("SHA256: can't update because hash was finished.");let t=0;if(this.bytesHashed+=i,this.bufferLength>0){for(;this.bufferLength<64&&i>0;)this.buffer[this.bufferLength++]=e[t++],i--;this.bufferLength===64&&(ln(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(i>=64&&(t=ln(this.temp,this.state,e,t,i),i%=64);i>0;)this.buffer[this.bufferLength++]=e[t++],i--;return this}finish(e){if(!this.finished){let i=this.bytesHashed,t=this.bufferLength,r=i/536870912|0,s=i<<3,o=i%64<56?64:128;this.buffer[t]=128;for(let a=t+1;a<o-8;a++)this.buffer[a]=0;this.buffer[o-8]=r>>>24&255,this.buffer[o-7]=r>>>16&255,this.buffer[o-6]=r>>>8&255,this.buffer[o-5]=r>>>0&255,this.buffer[o-4]=s>>>24&255,this.buffer[o-3]=s>>>16&255,this.buffer[o-2]=s>>>8&255,this.buffer[o-1]=s>>>0&255,ln(this.temp,this.state,this.buffer,0,o),this.finished=!0}for(let i=0;i<8;i++)e[i*4+0]=this.state[i]>>>24&255,e[i*4+1]=this.state[i]>>>16&255,e[i*4+2]=this.state[i]>>>8&255,e[i*4+3]=this.state[i]>>>0&255;return this}digest(){let e=new Uint8Array(this.digestLength);return this.finish(e),e}_saveState(e){for(let i=0;i<this.state.length;i++)e[i]=this.state[i]}_restoreState(e,i){for(let t=0;t<this.state.length;t++)this.state[t]=e[t];this.bytesHashed=i,this.finished=!1,this.bufferLength=0}};function Io(n){let e=new dn().update(n),i=e.digest();return e.clean(),i}var bc=new Uint8Array(Kr);var Ai=class{};function ko(n){if(typeof n!="string")throw new TypeError("expected string");let e=n,i=new Uint8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.charCodeAt(t);return i}function xo(n){let e=[];for(let i=0;i<n.length;i++)e.push(String.fromCharCode(n[i]));return e.join("")}var So=(()=>{let e=class e{calcHash(t,r){return z(this,null,function*(){return xo(Io(ko(t)))})}toHashString2(t){let r="";for(let s of t)r+=String.fromCharCode(s);return r}toHashString(t){let r=new Uint8Array(t),s="";for(let o of r)s+=String.fromCharCode(o);return s}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=I({token:e,factory:e.\u0275fac});let n=e;return n})(),Fi=(()=>{let e=class e extends ht{constructor(t,r,s,o,a,u,h,g,T,p){super(),this.ngZone=t,this.http=r,this.config=a,this.urlHelper=u,this.logger=h,this.crypto=g,this.dateTimeService=p,this.discoveryDocumentLoaded=!1,this.state="",this.eventsSubject=new Ve,this.discoveryDocumentLoadedSubject=new Ve,this.grantTypesSupported=[],this.inImplicitFlow=!1,this.saveNoncesInLocalStorage=!1,this.debug("angular-oauth2-oidc v10"),this.document=T,a||(a={}),this.discoveryDocumentLoaded$=this.discoveryDocumentLoadedSubject.asObservable(),this.events=this.eventsSubject.asObservable(),o&&(this.tokenValidationHandler=o),a&&this.configure(a);try{s?this.setStorage(s):typeof sessionStorage<"u"&&this.setStorage(sessionStorage)}catch(v){console.error("No OAuthStorage provided and cannot access default (sessionStorage).Consider providing a custom OAuthStorage implementation in your module.",v)}if(this.checkLocalStorageAccessable()){let v=window?.navigator?.userAgent;(v?.includes("MSIE ")||v?.includes("Trident"))&&(this.saveNoncesInLocalStorage=!0)}this.setupRefreshTimer()}checkLocalStorageAccessable(){if(typeof window>"u")return!1;let t="test";try{return typeof window.localStorage>"u"?!1:(localStorage.setItem(t,t),localStorage.removeItem(t),!0)}catch{return!1}}configure(t){Object.assign(this,new ht,t),this.config=Object.assign({},new ht,t),this.sessionChecksEnabled&&this.setupSessionCheck(),this.configChanged()}configChanged(){this.setupRefreshTimer()}restartSessionChecksIfStillLoggedIn(){this.hasValidIdToken()&&this.initSessionCheck()}restartRefreshTimerIfStillLoggedIn(){this.setupExpirationTimers()}setupSessionCheck(){this.events.pipe(te(t=>t.type==="token_received")).subscribe(()=>{this.initSessionCheck()})}setupAutomaticSilentRefresh(t={},r,s=!0){let o=!0;this.clearAutomaticRefreshTimer(),this.automaticRefreshSubscription=this.events.pipe(Ui(a=>{a.type==="token_received"?o=!0:a.type==="logout"&&(o=!1)}),te(a=>a.type==="token_expires"&&(r==null||r==="any"||a.info===r)),Ht(1e3)).subscribe(()=>{o&&this.refreshInternal(t,s).catch(()=>{this.debug("Automatic silent refresh did not work")})}),this.restartRefreshTimerIfStillLoggedIn()}refreshInternal(t,r){return!this.useSilentRefresh&&this.responseType==="code"?this.refreshToken():this.silentRefresh(t,r)}loadDiscoveryDocumentAndTryLogin(t=null){return this.loadDiscoveryDocument().then(()=>this.tryLogin(t))}loadDiscoveryDocumentAndLogin(t=null){return t=t||{},this.loadDiscoveryDocumentAndTryLogin(t).then(()=>{if(!this.hasValidIdToken()||!this.hasValidAccessToken()){let r=typeof t.state=="string"?t.state:"";return this.initLoginFlow(r),!1}else return!0})}debug(...t){this.showDebugInformation&&this.logger.debug(...t)}validateUrlFromDiscoveryDocument(t){let r=[],s=this.validateUrlForHttps(t),o=this.validateUrlAgainstIssuer(t);return s||r.push("https for all urls required. Also for urls received by discovery."),o||r.push("Every url in discovery document has to start with the issuer url.Also see property strictDiscoveryDocumentValidation."),r}validateUrlForHttps(t){if(!t)return!0;let r=t.toLowerCase();return this.requireHttps===!1||(r.match(/^http:\/\/localhost($|[:/])/)||r.match(/^http:\/\/localhost($|[:/])/))&&this.requireHttps==="remoteOnly"?!0:r.startsWith("https://")}assertUrlNotNullAndCorrectProtocol(t,r){if(!t)throw new Error(`'${r}' should not be null`);if(!this.validateUrlForHttps(t))throw new Error(`'${r}' must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).`)}validateUrlAgainstIssuer(t){return!this.strictDiscoveryDocumentValidation||!t?!0:t.toLowerCase().startsWith(this.issuer.toLowerCase())}setupRefreshTimer(){if(typeof window>"u"){this.debug("timer not supported on this plattform");return}(this.hasValidIdToken()||this.hasValidAccessToken())&&(this.clearAccessTokenTimer(),this.clearIdTokenTimer(),this.setupExpirationTimers()),this.tokenReceivedSubscription&&this.tokenReceivedSubscription.unsubscribe(),this.tokenReceivedSubscription=this.events.pipe(te(t=>t.type==="token_received")).subscribe(()=>{this.clearAccessTokenTimer(),this.clearIdTokenTimer(),this.setupExpirationTimers()})}setupExpirationTimers(){this.hasValidAccessToken()&&this.setupAccessTokenTimer(),!this.disableIdTokenTimer&&this.hasValidIdToken()&&this.setupIdTokenTimer()}setupAccessTokenTimer(){let t=this.getAccessTokenExpiration(),r=this.getAccessTokenStoredAt(),s=this.calcTimeout(r,t);this.ngZone.runOutsideAngular(()=>{this.accessTokenTimeoutSubscription=J(new ae("token_expires","access_token")).pipe(Wt(s)).subscribe(o=>{this.ngZone.run(()=>{this.eventsSubject.next(o)})})})}setupIdTokenTimer(){let t=this.getIdTokenExpiration(),r=this.getIdTokenStoredAt(),s=this.calcTimeout(r,t);this.ngZone.runOutsideAngular(()=>{this.idTokenTimeoutSubscription=J(new ae("token_expires","id_token")).pipe(Wt(s)).subscribe(o=>{this.ngZone.run(()=>{this.eventsSubject.next(o)})})})}stopAutomaticRefresh(){this.clearAccessTokenTimer(),this.clearIdTokenTimer(),this.clearAutomaticRefreshTimer()}clearAccessTokenTimer(){this.accessTokenTimeoutSubscription&&this.accessTokenTimeoutSubscription.unsubscribe()}clearIdTokenTimer(){this.idTokenTimeoutSubscription&&this.idTokenTimeoutSubscription.unsubscribe()}clearAutomaticRefreshTimer(){this.automaticRefreshSubscription&&this.automaticRefreshSubscription.unsubscribe()}calcTimeout(t,r){let s=this.dateTimeService.now(),o=(r-t)*this.timeoutFactor-(s-t),a=Math.max(0,o),u=2147483647;return a>u?u:a}setStorage(t){this._storage=t,this.configChanged()}loadDiscoveryDocument(t=null){return new Promise((r,s)=>{if(t||(t=this.issuer||"",t.endsWith("/")||(t+="/"),t+=".well-known/openid-configuration"),!this.validateUrlForHttps(t)){s("issuer  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");return}this.http.get(t).subscribe(o=>{if(!this.validateDiscoveryDocument(o)){this.eventsSubject.next(new V("discovery_document_validation_error",null)),s("discovery_document_validation_error");return}this.loginUrl=o.authorization_endpoint,this.logoutUrl=o.end_session_endpoint||this.logoutUrl,this.grantTypesSupported=o.grant_types_supported,this.issuer=o.issuer,this.tokenEndpoint=o.token_endpoint,this.userinfoEndpoint=o.userinfo_endpoint||this.userinfoEndpoint,this.jwksUri=o.jwks_uri,this.sessionCheckIFrameUrl=o.check_session_iframe||this.sessionCheckIFrameUrl,this.discoveryDocumentLoaded=!0,this.discoveryDocumentLoadedSubject.next(o),this.revocationEndpoint=o.revocation_endpoint||this.revocationEndpoint,this.sessionChecksEnabled&&this.restartSessionChecksIfStillLoggedIn(),this.loadJwks().then(a=>{let u={discoveryDocument:o,jwks:a},h=new $("discovery_document_loaded",u);this.eventsSubject.next(h),r(h)}).catch(a=>{this.eventsSubject.next(new V("discovery_document_load_error",a)),s(a)})},o=>{this.logger.error("error loading discovery document",o),this.eventsSubject.next(new V("discovery_document_load_error",o)),s(o)})})}loadJwks(){return new Promise((t,r)=>{this.jwksUri?this.http.get(this.jwksUri).subscribe(s=>{this.jwks=s,t(s)},s=>{this.logger.error("error loading jwks",s),this.eventsSubject.next(new V("jwks_load_error",s)),r(s)}):t(null)})}validateDiscoveryDocument(t){let r;return!this.skipIssuerCheck&&t.issuer!==this.issuer?(this.logger.error("invalid issuer in discovery document","expected: "+this.issuer,"current: "+t.issuer),!1):(r=this.validateUrlFromDiscoveryDocument(t.authorization_endpoint),r.length>0?(this.logger.error("error validating authorization_endpoint in discovery document",r),!1):(r=this.validateUrlFromDiscoveryDocument(t.end_session_endpoint),r.length>0?(this.logger.error("error validating end_session_endpoint in discovery document",r),!1):(r=this.validateUrlFromDiscoveryDocument(t.token_endpoint),r.length>0&&this.logger.error("error validating token_endpoint in discovery document",r),r=this.validateUrlFromDiscoveryDocument(t.revocation_endpoint),r.length>0&&this.logger.error("error validating revocation_endpoint in discovery document",r),r=this.validateUrlFromDiscoveryDocument(t.userinfo_endpoint),r.length>0?(this.logger.error("error validating userinfo_endpoint in discovery document",r),!1):(r=this.validateUrlFromDiscoveryDocument(t.jwks_uri),r.length>0?(this.logger.error("error validating jwks_uri in discovery document",r),!1):(this.sessionChecksEnabled&&!t.check_session_iframe&&this.logger.warn("sessionChecksEnabled is activated but discovery document does not contain a check_session_iframe field"),!0)))))}fetchTokenUsingPasswordFlowAndLoadUserProfile(t,r,s=new Ee){return this.fetchTokenUsingPasswordFlow(t,r,s).then(()=>this.loadUserProfile())}loadUserProfile(){if(!this.hasValidAccessToken())throw new Error("Can not load User Profile without access_token");if(!this.validateUrlForHttps(this.userinfoEndpoint))throw new Error("userinfoEndpoint must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");return new Promise((t,r)=>{let s=new Ee().set("Authorization","Bearer "+this.getAccessToken());this.http.get(this.userinfoEndpoint,{headers:s,observe:"response",responseType:"text"}).subscribe(o=>{if(this.debug("userinfo received",JSON.stringify(o)),o.headers.get("content-type").startsWith("application/json")){let a=JSON.parse(o.body),u=this.getIdentityClaims()||{};if(!this.skipSubjectCheck&&this.oidc&&(!u.sub||a.sub!==u.sub)){r(`if property oidc is true, the received user-id (sub) has to be the user-id of the user that has logged in with oidc.
if you are not using oidc but just oauth2 password flow set oidc to false`);return}a=Object.assign({},u,a),this._storage.setItem("id_token_claims_obj",JSON.stringify(a)),this.eventsSubject.next(new $("user_profile_loaded")),t({info:a})}else this.debug("userinfo is not JSON, treating it as JWE/JWS"),this.eventsSubject.next(new $("user_profile_loaded")),t(JSON.parse(o.body))},o=>{this.logger.error("error loading user info",o),this.eventsSubject.next(new V("user_profile_load_error",o)),r(o)})})}fetchTokenUsingPasswordFlow(t,r,s=new Ee){let o={username:t,password:r};return this.fetchTokenUsingGrant("password",o,s)}fetchTokenUsingGrant(t,r,s=new Ee){this.assertUrlNotNullAndCorrectProtocol(this.tokenEndpoint,"tokenEndpoint");let o=new Xe({encoder:new $e}).set("grant_type",t).set("scope",this.scope);if(this.useHttpBasicAuth){let a=btoa(`${this.clientId}:${this.dummyClientSecret}`);s=s.set("Authorization","Basic "+a)}if(this.useHttpBasicAuth||(o=o.set("client_id",this.clientId)),!this.useHttpBasicAuth&&this.dummyClientSecret&&(o=o.set("client_secret",this.dummyClientSecret)),this.customQueryParams)for(let a of Object.getOwnPropertyNames(this.customQueryParams))o=o.set(a,this.customQueryParams[a]);for(let a of Object.keys(r))o=o.set(a,r[a]);return s=s.set("Content-Type","application/x-www-form-urlencoded"),new Promise((a,u)=>{this.http.post(this.tokenEndpoint,o,{headers:s}).subscribe(h=>{this.debug("tokenResponse",h),this.storeAccessTokenResponse(h.access_token,h.refresh_token,h.expires_in||this.fallbackAccessTokenExpirationTimeInSec,h.scope,this.extractRecognizedCustomParameters(h)),this.oidc&&h.id_token&&this.processIdToken(h.id_token,h.access_token).then(g=>{this.storeIdToken(g),a(h)}),this.eventsSubject.next(new $("token_received")),a(h)},h=>{this.logger.error("Error performing ${grantType} flow",h),this.eventsSubject.next(new V("token_error",h)),u(h)})})}refreshToken(){return this.assertUrlNotNullAndCorrectProtocol(this.tokenEndpoint,"tokenEndpoint"),new Promise((t,r)=>{let s=new Xe({encoder:new $e}).set("grant_type","refresh_token").set("scope",this.scope).set("refresh_token",this._storage.getItem("refresh_token")),o=new Ee().set("Content-Type","application/x-www-form-urlencoded");if(this.useHttpBasicAuth){let a=btoa(`${this.clientId}:${this.dummyClientSecret}`);o=o.set("Authorization","Basic "+a)}if(this.useHttpBasicAuth||(s=s.set("client_id",this.clientId)),!this.useHttpBasicAuth&&this.dummyClientSecret&&(s=s.set("client_secret",this.dummyClientSecret)),this.customQueryParams)for(let a of Object.getOwnPropertyNames(this.customQueryParams))s=s.set(a,this.customQueryParams[a]);this.http.post(this.tokenEndpoint,s,{headers:o}).pipe(On(a=>this.oidc&&a.id_token?Nt(this.processIdToken(a.id_token,a.access_token,!0)).pipe(Ui(u=>this.storeIdToken(u)),W(()=>a)):J(a))).subscribe(a=>{this.debug("refresh tokenResponse",a),this.storeAccessTokenResponse(a.access_token,a.refresh_token,a.expires_in||this.fallbackAccessTokenExpirationTimeInSec,a.scope,this.extractRecognizedCustomParameters(a)),this.eventsSubject.next(new $("token_received")),this.eventsSubject.next(new $("token_refreshed")),t(a)},a=>{this.logger.error("Error refreshing token",a),this.eventsSubject.next(new V("token_refresh_error",a)),r(a)})})}removeSilentRefreshEventListener(){this.silentRefreshPostMessageEventListener&&(window.removeEventListener("message",this.silentRefreshPostMessageEventListener),this.silentRefreshPostMessageEventListener=null)}setupSilentRefreshEventListener(){this.removeSilentRefreshEventListener(),this.silentRefreshPostMessageEventListener=t=>{let r=this.processMessageEventMessage(t);this.checkOrigin&&t.origin!==location.origin&&console.error("wrong origin requested silent refresh!"),this.tryLogin({customHashFragment:r,preventClearHashAfterLogin:!0,customRedirectUri:this.silentRefreshRedirectUri||this.redirectUri}).catch(s=>this.debug("tryLogin during silent refresh failed",s))},window.addEventListener("message",this.silentRefreshPostMessageEventListener)}silentRefresh(t={},r=!0){let s=this.getIdentityClaims()||{};if(this.useIdTokenHintForSilentRefresh&&this.hasValidIdToken()&&(t.id_token_hint=this.getIdToken()),!this.validateUrlForHttps(this.loginUrl))throw new Error("loginUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");if(typeof this.document>"u")throw new Error("silent refresh is not supported on this platform");let o=this.document.getElementById(this.silentRefreshIFrameName);o&&this.document.body.removeChild(o),this.silentRefreshSubject=s.sub;let a=this.document.createElement("iframe");a.id=this.silentRefreshIFrameName,this.setupSilentRefreshEventListener();let u=this.silentRefreshRedirectUri||this.redirectUri;this.createLoginUrl(null,null,u,r,t).then(p=>{a.setAttribute("src",p),this.silentRefreshShowIFrame||(a.style.display="none"),this.document.body.appendChild(a)});let h=this.events.pipe(te(p=>p instanceof V),Gt()),g=this.events.pipe(te(p=>p.type==="token_received"),Gt()),T=J(new V("silent_refresh_timeout",null)).pipe(Wt(this.silentRefreshTimeout));return An([h,g,T]).pipe(W(p=>{if(p instanceof V)throw p.type==="silent_refresh_timeout"?this.eventsSubject.next(p):(p=new V("silent_refresh_error",p),this.eventsSubject.next(p)),p;return p.type==="token_received"&&(p=new $("silently_refreshed"),this.eventsSubject.next(p)),p})).toPromise()}initImplicitFlowInPopup(t){return this.initLoginFlowInPopup(t)}initLoginFlowInPopup(t){return t=t||{},this.createLoginUrl(null,null,this.silentRefreshRedirectUri,!1,{display:"popup"}).then(r=>new Promise((s,o)=>{let u=null;t.windowRef?t.windowRef&&!t.windowRef.closed&&(u=t.windowRef,u.location.href=r):u=window.open(r,"ngx-oauth2-oidc-login",this.calculatePopupFeatures(t));let h,g=F=>{this.tryLogin({customHashFragment:F,preventClearHashAfterLogin:!0,customRedirectUri:this.silentRefreshRedirectUri}).then(()=>{p(),s(!0)},N=>{p(),o(N)})},T=()=>{(!u||u.closed)&&(p(),o(new V("popup_closed",{})))};u?h=window.setInterval(T,500):o(new V("popup_blocked",{}));let p=()=>{window.clearInterval(h),window.removeEventListener("storage",b),window.removeEventListener("message",v),u!==null&&u.close(),u=null},v=F=>{let N=this.processMessageEventMessage(F);N&&N!==null?(window.removeEventListener("storage",b),g(N)):console.log("false event firing")},b=F=>{F.key==="auth_hash"&&(window.removeEventListener("message",v),g(F.newValue))};window.addEventListener("message",v),window.addEventListener("storage",b)}))}calculatePopupFeatures(t){let r=t.height||470,s=t.width||500,o=window.screenLeft+(window.outerWidth-s)/2,a=window.screenTop+(window.outerHeight-r)/2;return`location=no,toolbar=no,width=${s},height=${r},top=${a},left=${o}`}processMessageEventMessage(t){let r="#";if(this.silentRefreshMessagePrefix&&(r+=this.silentRefreshMessagePrefix),!t||!t.data||typeof t.data!="string")return;let s=t.data;if(s.startsWith(r))return"#"+s.substr(r.length)}canPerformSessionCheck(){return this.sessionChecksEnabled?this.sessionCheckIFrameUrl?this.getSessionState()?!(typeof this.document>"u"):(console.warn("sessionChecksEnabled is activated but there is no session_state"),!1):(console.warn("sessionChecksEnabled is activated but there is no sessionCheckIFrameUrl"),!1):!1}setupSessionCheckEventListener(){this.removeSessionCheckEventListener(),this.sessionCheckEventListener=t=>{let r=t.origin.toLowerCase(),s=this.issuer.toLowerCase();if(this.debug("sessionCheckEventListener"),!s.startsWith(r)){this.debug("sessionCheckEventListener","wrong origin",r,"expected",s,"event",t);return}switch(t.data){case"unchanged":this.ngZone.run(()=>{this.handleSessionUnchanged()});break;case"changed":this.ngZone.run(()=>{this.handleSessionChange()});break;case"error":this.ngZone.run(()=>{this.handleSessionError()});break}this.debug("got info from session check inframe",t)},this.ngZone.runOutsideAngular(()=>{window.addEventListener("message",this.sessionCheckEventListener)})}handleSessionUnchanged(){this.debug("session check","session unchanged"),this.eventsSubject.next(new ae("session_unchanged"))}handleSessionChange(){this.eventsSubject.next(new ae("session_changed")),this.stopSessionCheckTimer(),!this.useSilentRefresh&&this.responseType==="code"?this.refreshToken().then(()=>{this.debug("token refresh after session change worked")}).catch(()=>{this.debug("token refresh did not work after session changed"),this.eventsSubject.next(new ae("session_terminated")),this.logOut(!0)}):this.silentRefreshRedirectUri?(this.silentRefresh().catch(()=>this.debug("silent refresh failed after session changed")),this.waitForSilentRefreshAfterSessionChange()):(this.eventsSubject.next(new ae("session_terminated")),this.logOut(!0))}waitForSilentRefreshAfterSessionChange(){this.events.pipe(te(t=>t.type==="silently_refreshed"||t.type==="silent_refresh_timeout"||t.type==="silent_refresh_error"),Gt()).subscribe(t=>{t.type!=="silently_refreshed"&&(this.debug("silent refresh did not work after session changed"),this.eventsSubject.next(new ae("session_terminated")),this.logOut(!0))})}handleSessionError(){this.stopSessionCheckTimer(),this.eventsSubject.next(new ae("session_error"))}removeSessionCheckEventListener(){this.sessionCheckEventListener&&(window.removeEventListener("message",this.sessionCheckEventListener),this.sessionCheckEventListener=null)}initSessionCheck(){if(!this.canPerformSessionCheck())return;let t=this.document.getElementById(this.sessionCheckIFrameName);t&&this.document.body.removeChild(t);let r=this.document.createElement("iframe");r.id=this.sessionCheckIFrameName,this.setupSessionCheckEventListener();let s=this.sessionCheckIFrameUrl;r.setAttribute("src",s),r.style.display="none",this.document.body.appendChild(r),this.startSessionCheckTimer()}startSessionCheckTimer(){this.stopSessionCheckTimer(),this.ngZone.runOutsideAngular(()=>{this.sessionCheckTimer=setInterval(this.checkSession.bind(this),this.sessionCheckIntervall)})}stopSessionCheckTimer(){this.sessionCheckTimer&&(clearInterval(this.sessionCheckTimer),this.sessionCheckTimer=null)}checkSession(){let t=this.document.getElementById(this.sessionCheckIFrameName);t||this.logger.warn("checkSession did not find iframe",this.sessionCheckIFrameName);let r=this.getSessionState();r||this.stopSessionCheckTimer();let s=this.clientId+" "+r;t.contentWindow.postMessage(s,this.issuer)}createLoginUrl(){return z(this,arguments,function*(t="",r="",s="",o=!1,a={}){let u=this,h;s?h=s:h=this.redirectUri;let g=yield this.createAndSaveNonce();if(t?t=g+this.config.nonceStateSeparator+encodeURIComponent(t):t=g,!this.requestAccessToken&&!this.oidc)throw new Error("Either requestAccessToken or oidc or both must be true");this.config.responseType?this.responseType=this.config.responseType:this.oidc&&this.requestAccessToken?this.responseType="id_token token":this.oidc&&!this.requestAccessToken?this.responseType="id_token":this.responseType="token";let T=u.loginUrl.indexOf("?")>-1?"&":"?",p=u.scope;this.oidc&&!p.match(/(^|\s)openid($|\s)/)&&(p="openid "+p);let v=u.loginUrl+T+"response_type="+encodeURIComponent(u.responseType)+"&client_id="+encodeURIComponent(u.clientId)+"&state="+encodeURIComponent(t)+"&redirect_uri="+encodeURIComponent(h)+"&scope="+encodeURIComponent(p);if(this.responseType.includes("code")&&!this.disablePKCE){let[b,F]=yield this.createChallangeVerifierPairForPKCE();this.saveNoncesInLocalStorage&&typeof window.localStorage<"u"?localStorage.setItem("PKCE_verifier",F):this._storage.setItem("PKCE_verifier",F),v+="&code_challenge="+b,v+="&code_challenge_method=S256"}r&&(v+="&login_hint="+encodeURIComponent(r)),u.resource&&(v+="&resource="+encodeURIComponent(u.resource)),u.oidc&&(v+="&nonce="+encodeURIComponent(g)),o&&(v+="&prompt=none");for(let b of Object.keys(a))v+="&"+encodeURIComponent(b)+"="+encodeURIComponent(a[b]);if(this.customQueryParams)for(let b of Object.getOwnPropertyNames(this.customQueryParams))v+="&"+b+"="+encodeURIComponent(this.customQueryParams[b]);return v})}initImplicitFlowInternal(t="",r=""){if(this.inImplicitFlow)return;if(this.inImplicitFlow=!0,!this.validateUrlForHttps(this.loginUrl))throw new Error("loginUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");let s={},o=null;typeof r=="string"?o=r:typeof r=="object"&&(s=r),this.createLoginUrl(t,o,null,!1,s).then(this.config.openUri).catch(a=>{console.error("Error in initImplicitFlow",a),this.inImplicitFlow=!1})}initImplicitFlow(t="",r=""){this.loginUrl!==""?this.initImplicitFlowInternal(t,r):this.events.pipe(te(s=>s.type==="discovery_document_loaded")).subscribe(()=>this.initImplicitFlowInternal(t,r))}resetImplicitFlow(){this.inImplicitFlow=!1}callOnTokenReceivedIfExists(t){let r=this;if(t.onTokenReceived){let s={idClaims:r.getIdentityClaims(),idToken:r.getIdToken(),accessToken:r.getAccessToken(),state:r.state};t.onTokenReceived(s)}}storeAccessTokenResponse(t,r,s,o,a){if(this._storage.setItem("access_token",t),o&&!Array.isArray(o)?this._storage.setItem("granted_scopes",JSON.stringify(o.split(" "))):o&&Array.isArray(o)&&this._storage.setItem("granted_scopes",JSON.stringify(o)),this._storage.setItem("access_token_stored_at",""+this.dateTimeService.now()),s){let u=s*1e3,g=this.dateTimeService.new().getTime()+u;this._storage.setItem("expires_at",""+g)}r&&this._storage.setItem("refresh_token",r),a&&a.forEach((u,h)=>{this._storage.setItem(h,u)})}tryLogin(t=null){return this.config.responseType==="code"?this.tryLoginCodeFlow(t).then(()=>!0):this.tryLoginImplicitFlow(t)}parseQueryString(t){return!t||t.length===0?{}:(t.charAt(0)==="?"&&(t=t.substr(1)),this.urlHelper.parseQueryString(t))}tryLoginCodeFlow(t=null){return z(this,null,function*(){t=t||{};let r=t.customHashFragment?t.customHashFragment.substring(1):window.location.search,s=this.getCodePartsFromUrl(r),o=s.code,a=s.state,u=s.session_state;if(!t.preventClearHashAfterLogin){let T=location.origin+location.pathname+location.search.replace(/code=[^&$]*/,"").replace(/scope=[^&$]*/,"").replace(/state=[^&$]*/,"").replace(/session_state=[^&$]*/,"").replace(/^\?&/,"?").replace(/&$/,"").replace(/^\?$/,"").replace(/&+/g,"&").replace(/\?&/,"?").replace(/\?$/,"")+location.hash;history.replaceState(null,window.name,T)}let[h,g]=this.parseState(a);if(this.state=g,s.error){this.debug("error trying to login"),this.handleLoginError(t,s);let T=new V("code_error",{},s);return this.eventsSubject.next(T),Promise.reject(T)}if(!t.disableNonceCheck){if(!h)return this.saveRequestedRoute(),Promise.resolve();if(!t.disableOAuth2StateCheck&&!this.validateNonce(h)){let p=new V("invalid_nonce_in_state",null);return this.eventsSubject.next(p),Promise.reject(p)}}return this.storeSessionState(u),o&&(yield this.getTokenFromCode(o,t),this.restoreRequestedRoute()),Promise.resolve()})}saveRequestedRoute(){this.config.preserveRequestedRoute&&this._storage.setItem("requested_route",window.location.pathname+window.location.search)}restoreRequestedRoute(){let t=this._storage.getItem("requested_route");t&&history.replaceState(null,"",window.location.origin+t)}getCodePartsFromUrl(t){return!t||t.length===0?this.urlHelper.getHashFragmentParams():(t.charAt(0)==="?"&&(t=t.substr(1)),this.urlHelper.parseQueryString(t))}getTokenFromCode(t,r){let s=new Xe({encoder:new $e}).set("grant_type","authorization_code").set("code",t).set("redirect_uri",r.customRedirectUri||this.redirectUri);if(!this.disablePKCE){let o;this.saveNoncesInLocalStorage&&typeof window.localStorage<"u"?o=localStorage.getItem("PKCE_verifier"):o=this._storage.getItem("PKCE_verifier"),o?s=s.set("code_verifier",o):console.warn("No PKCE verifier found in oauth storage!")}return this.fetchAndProcessToken(s,r)}fetchAndProcessToken(t,r){r=r||{},this.assertUrlNotNullAndCorrectProtocol(this.tokenEndpoint,"tokenEndpoint");let s=new Ee().set("Content-Type","application/x-www-form-urlencoded");if(this.useHttpBasicAuth){let o=btoa(`${this.clientId}:${this.dummyClientSecret}`);s=s.set("Authorization","Basic "+o)}return this.useHttpBasicAuth||(t=t.set("client_id",this.clientId)),!this.useHttpBasicAuth&&this.dummyClientSecret&&(t=t.set("client_secret",this.dummyClientSecret)),new Promise((o,a)=>{if(this.customQueryParams)for(let u of Object.getOwnPropertyNames(this.customQueryParams))t=t.set(u,this.customQueryParams[u]);this.http.post(this.tokenEndpoint,t,{headers:s}).subscribe(u=>{this.debug("refresh tokenResponse",u),this.storeAccessTokenResponse(u.access_token,u.refresh_token,u.expires_in||this.fallbackAccessTokenExpirationTimeInSec,u.scope,this.extractRecognizedCustomParameters(u)),this.oidc&&u.id_token?this.processIdToken(u.id_token,u.access_token,r.disableNonceCheck).then(h=>{this.storeIdToken(h),this.eventsSubject.next(new $("token_received")),this.eventsSubject.next(new $("token_refreshed")),o(u)}).catch(h=>{this.eventsSubject.next(new V("token_validation_error",h)),console.error("Error validating tokens"),console.error(h),a(h)}):(this.eventsSubject.next(new $("token_received")),this.eventsSubject.next(new $("token_refreshed")),o(u))},u=>{console.error("Error getting token",u),this.eventsSubject.next(new V("token_refresh_error",u)),a(u)})})}tryLoginImplicitFlow(t=null){t=t||{};let r;t.customHashFragment?r=this.urlHelper.getHashFragmentParams(t.customHashFragment):r=this.urlHelper.getHashFragmentParams(),this.debug("parsed url",r);let s=r.state,[o,a]=this.parseState(s);if(this.state=a,r.error){this.debug("error trying to login"),this.handleLoginError(t,r);let p=new V("token_error",{},r);return this.eventsSubject.next(p),Promise.reject(p)}let u=r.access_token,h=r.id_token,g=r.session_state,T=r.scope;if(!this.requestAccessToken&&!this.oidc)return Promise.reject("Either requestAccessToken or oidc (or both) must be true.");if(this.requestAccessToken&&!u||this.requestAccessToken&&!t.disableOAuth2StateCheck&&!s||this.oidc&&!h)return Promise.resolve(!1);if(this.sessionChecksEnabled&&!g&&this.logger.warn("session checks (Session Status Change Notification) were activated in the configuration but the id_token does not contain a session_state claim"),this.requestAccessToken&&!t.disableNonceCheck&&!this.validateNonce(o)){let v=new V("invalid_nonce_in_state",null);return this.eventsSubject.next(v),Promise.reject(v)}return this.requestAccessToken&&this.storeAccessTokenResponse(u,null,r.expires_in||this.fallbackAccessTokenExpirationTimeInSec,T),this.oidc?this.processIdToken(h,u,t.disableNonceCheck).then(p=>t.validationHandler?t.validationHandler({accessToken:u,idClaims:p.idTokenClaims,idToken:p.idToken,state:s}).then(()=>p):p).then(p=>(this.storeIdToken(p),this.storeSessionState(g),this.clearHashAfterLogin&&!t.preventClearHashAfterLogin&&this.clearLocationHash(),this.eventsSubject.next(new $("token_received")),this.callOnTokenReceivedIfExists(t),this.inImplicitFlow=!1,!0)).catch(p=>(this.eventsSubject.next(new V("token_validation_error",p)),this.logger.error("Error validating tokens"),this.logger.error(p),Promise.reject(p))):(this.eventsSubject.next(new $("token_received")),this.clearHashAfterLogin&&!t.preventClearHashAfterLogin&&this.clearLocationHash(),this.callOnTokenReceivedIfExists(t),Promise.resolve(!0))}parseState(t){let r=t,s="";if(t){let o=t.indexOf(this.config.nonceStateSeparator);o>-1&&(r=t.substr(0,o),s=t.substr(o+this.config.nonceStateSeparator.length))}return[r,s]}validateNonce(t){let r;return this.saveNoncesInLocalStorage&&typeof window.localStorage<"u"?r=localStorage.getItem("nonce"):r=this._storage.getItem("nonce"),r!==t?(console.error("Validating access_token failed, wrong state/nonce.",r,t),!1):!0}storeIdToken(t){this._storage.setItem("id_token",t.idToken),this._storage.setItem("id_token_claims_obj",t.idTokenClaimsJson),this._storage.setItem("id_token_expires_at",""+t.idTokenExpiresAt),this._storage.setItem("id_token_stored_at",""+this.dateTimeService.now())}storeSessionState(t){this._storage.setItem("session_state",t)}getSessionState(){return this._storage.getItem("session_state")}handleLoginError(t,r){t.onLoginError&&t.onLoginError(r),this.clearHashAfterLogin&&!t.preventClearHashAfterLogin&&this.clearLocationHash()}getClockSkewInMsec(t=6e5){return!this.clockSkewInSec&&this.clockSkewInSec!==0?t:this.clockSkewInSec*1e3}processIdToken(t,r,s=!1){let o=t.split("."),a=this.padBase64(o[0]),u=$r(a),h=JSON.parse(u),g=this.padBase64(o[1]),T=$r(g),p=JSON.parse(T),v;if(this.saveNoncesInLocalStorage&&typeof window.localStorage<"u"?v=localStorage.getItem("nonce"):v=this._storage.getItem("nonce"),Array.isArray(p.aud)){if(p.aud.every(x=>x!==this.clientId)){let x="Wrong audience: "+p.aud.join(",");return this.logger.warn(x),Promise.reject(x)}}else if(p.aud!==this.clientId){let x="Wrong audience: "+p.aud;return this.logger.warn(x),Promise.reject(x)}if(!p.sub){let x="No sub claim in id_token";return this.logger.warn(x),Promise.reject(x)}if(this.sessionChecksEnabled&&this.silentRefreshSubject&&this.silentRefreshSubject!==p.sub){let x=`After refreshing, we got an id_token for another user (sub). Expected sub: ${this.silentRefreshSubject}, received sub: ${p.sub}`;return this.logger.warn(x),Promise.reject(x)}if(!p.iat){let x="No iat claim in id_token";return this.logger.warn(x),Promise.reject(x)}if(!this.skipIssuerCheck&&p.iss!==this.issuer){let x="Wrong issuer: "+p.iss;return this.logger.warn(x),Promise.reject(x)}if(!s&&p.nonce!==v){let x="Wrong nonce: "+p.nonce;return this.logger.warn(x),Promise.reject(x)}if(Object.prototype.hasOwnProperty.call(this,"responseType")&&(this.responseType==="code"||this.responseType==="id_token")&&(this.disableAtHashCheck=!0),!this.disableAtHashCheck&&this.requestAccessToken&&!p.at_hash){let x="An at_hash is needed!";return this.logger.warn(x),Promise.reject(x)}let b=this.dateTimeService.now(),F=p.iat*1e3,N=p.exp*1e3,fe=this.getClockSkewInMsec();if(F-fe>=b||N+fe-this.decreaseExpirationBySec<=b){let x="Token has expired";return console.error(x),console.error({now:b,issuedAtMSec:F,expiresAtMSec:N}),Promise.reject(x)}let xe={accessToken:r,idToken:t,jwks:this.jwks,idTokenClaims:p,idTokenHeader:h,loadKeys:()=>this.loadJwks()};return this.disableAtHashCheck?this.checkSignature(xe).then(()=>({idToken:t,idTokenClaims:p,idTokenClaimsJson:T,idTokenHeader:h,idTokenHeaderJson:u,idTokenExpiresAt:N})):this.checkAtHash(xe).then(x=>{if(!this.disableAtHashCheck&&this.requestAccessToken&&!x){let Rt="Wrong at_hash";return this.logger.warn(Rt),Promise.reject(Rt)}return this.checkSignature(xe).then(()=>{let Rt=!this.disableAtHashCheck,In={idToken:t,idTokenClaims:p,idTokenClaimsJson:T,idTokenHeader:h,idTokenHeaderJson:u,idTokenExpiresAt:N};return Rt?this.checkAtHash(xe).then(bs=>{if(this.requestAccessToken&&!bs){let kn="Wrong at_hash";return this.logger.warn(kn),Promise.reject(kn)}else return In}):In})})}getIdentityClaims(){let t=this._storage.getItem("id_token_claims_obj");return t?JSON.parse(t):null}getGrantedScopes(){let t=this._storage.getItem("granted_scopes");return t?JSON.parse(t):null}getIdToken(){return this._storage?this._storage.getItem("id_token"):null}padBase64(t){for(;t.length%4!==0;)t+="=";return t}getAccessToken(){return this._storage?this._storage.getItem("access_token"):null}getRefreshToken(){return this._storage?this._storage.getItem("refresh_token"):null}getAccessTokenExpiration(){return this._storage.getItem("expires_at")?parseInt(this._storage.getItem("expires_at"),10):null}getAccessTokenStoredAt(){return parseInt(this._storage.getItem("access_token_stored_at"),10)}getIdTokenStoredAt(){return parseInt(this._storage.getItem("id_token_stored_at"),10)}getIdTokenExpiration(){return this._storage.getItem("id_token_expires_at")?parseInt(this._storage.getItem("id_token_expires_at"),10):null}hasValidAccessToken(){if(this.getAccessToken()){let t=this._storage.getItem("expires_at"),r=this.dateTimeService.new();return!(t&&parseInt(t,10)-this.decreaseExpirationBySec<r.getTime()-this.getClockSkewInMsec())}return!1}hasValidIdToken(){if(this.getIdToken()){let t=this._storage.getItem("id_token_expires_at"),r=this.dateTimeService.new();return!(t&&parseInt(t,10)-this.decreaseExpirationBySec<r.getTime()-this.getClockSkewInMsec())}return!1}getCustomTokenResponseProperty(t){return this._storage&&this.config.customTokenParameters&&this.config.customTokenParameters.indexOf(t)>=0&&this._storage.getItem(t)!==null?JSON.parse(this._storage.getItem(t)):null}authorizationHeader(){return"Bearer "+this.getAccessToken()}logOut(t={},r=""){let s=!1;typeof t=="boolean"&&(s=t,t={});let o=this.getIdToken();if(this._storage.removeItem("access_token"),this._storage.removeItem("id_token"),this._storage.removeItem("refresh_token"),this.saveNoncesInLocalStorage?(localStorage.removeItem("nonce"),localStorage.removeItem("PKCE_verifier")):(this._storage.removeItem("nonce"),this._storage.removeItem("PKCE_verifier")),this._storage.removeItem("expires_at"),this._storage.removeItem("id_token_claims_obj"),this._storage.removeItem("id_token_expires_at"),this._storage.removeItem("id_token_stored_at"),this._storage.removeItem("access_token_stored_at"),this._storage.removeItem("granted_scopes"),this._storage.removeItem("session_state"),this.config.customTokenParameters&&this.config.customTokenParameters.forEach(u=>this._storage.removeItem(u)),this.silentRefreshSubject=null,this.eventsSubject.next(new ae("logout")),!this.logoutUrl||s)return;let a;if(!this.validateUrlForHttps(this.logoutUrl))throw new Error("logoutUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");if(this.logoutUrl.indexOf("{{")>-1)a=this.logoutUrl.replace(/\{\{id_token\}\}/,encodeURIComponent(o)).replace(/\{\{client_id\}\}/,encodeURIComponent(this.clientId));else{let u=new Xe({encoder:new $e});o&&(u=u.set("id_token_hint",o));let h=this.postLogoutRedirectUri||this.redirectUriAsPostLogoutRedirectUriFallback&&this.redirectUri||"";h&&(u=u.set("post_logout_redirect_uri",h),r&&(u=u.set("state",r)));for(let g in t)u=u.set(g,t[g]);a=this.logoutUrl+(this.logoutUrl.indexOf("?")>-1?"&":"?")+u.toString()}this.config.openUri(a)}createAndSaveNonce(){let t=this;return this.createNonce().then(function(r){return t.saveNoncesInLocalStorage&&typeof window.localStorage<"u"?localStorage.setItem("nonce",r):t._storage.setItem("nonce",r),r})}ngOnDestroy(){this.clearAccessTokenTimer(),this.clearIdTokenTimer(),this.removeSilentRefreshEventListener();let t=this.document.getElementById(this.silentRefreshIFrameName);t&&t.remove(),this.stopSessionCheckTimer(),this.removeSessionCheckEventListener();let r=this.document.getElementById(this.sessionCheckIFrameName);r&&r.remove()}createNonce(){return new Promise(t=>{if(this.rngUrl)throw new Error("createNonce with rng-web-api has not been implemented so far");let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=45,o="",a=typeof self>"u"?null:self.crypto||self.msCrypto;if(a){let u=new Uint8Array(s);a.getRandomValues(u),u.map||(u.map=Array.prototype.map),u=u.map(h=>r.charCodeAt(h%r.length)),o=String.fromCharCode.apply(null,u)}else for(;0<s--;)o+=r[Math.random()*r.length|0];t(zr(o))})}checkAtHash(t){return z(this,null,function*(){return this.tokenValidationHandler?this.tokenValidationHandler.validateAtHash(t):(this.logger.warn("No tokenValidationHandler configured. Cannot check at_hash."),!0)})}checkSignature(t){return this.tokenValidationHandler?this.tokenValidationHandler.validateSignature(t):(this.logger.warn("No tokenValidationHandler configured. Cannot check signature."),Promise.resolve(null))}initLoginFlow(t="",r={}){return this.responseType==="code"?this.initCodeFlow(t,r):this.initImplicitFlow(t,r)}initCodeFlow(t="",r={}){this.loginUrl!==""?this.initCodeFlowInternal(t,r):this.events.pipe(te(s=>s.type==="discovery_document_loaded")).subscribe(()=>this.initCodeFlowInternal(t,r))}initCodeFlowInternal(t="",r={}){if(!this.validateUrlForHttps(this.loginUrl))throw new Error("loginUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");let s={},o=null;typeof r=="string"?o=r:typeof r=="object"&&(s=r),this.createLoginUrl(t,o,null,!1,s).then(this.config.openUri).catch(a=>{console.error("Error in initAuthorizationCodeFlow"),console.error(a)})}createChallangeVerifierPairForPKCE(){return z(this,null,function*(){if(!this.crypto)throw new Error("PKCE support for code flow needs a CryptoHander. Did you import the OAuthModule using forRoot() ?");let t=yield this.createNonce(),r=yield this.crypto.calcHash(t,"sha-256");return[zr(r),t]})}extractRecognizedCustomParameters(t){let r=new Map;return this.config.customTokenParameters&&this.config.customTokenParameters.forEach(s=>{t[s]&&r.set(s,JSON.stringify(t[s]))}),r}revokeTokenAndLogout(t={},r=!1){let s=this.revocationEndpoint,o=this.getAccessToken(),a=this.getRefreshToken();if(!o)return Promise.resolve();let u=new Xe({encoder:new $e}),h=new Ee().set("Content-Type","application/x-www-form-urlencoded");if(this.useHttpBasicAuth){let g=btoa(`${this.clientId}:${this.dummyClientSecret}`);h=h.set("Authorization","Basic "+g)}if(this.useHttpBasicAuth||(u=u.set("client_id",this.clientId)),!this.useHttpBasicAuth&&this.dummyClientSecret&&(u=u.set("client_secret",this.dummyClientSecret)),this.customQueryParams)for(let g of Object.getOwnPropertyNames(this.customQueryParams))u=u.set(g,this.customQueryParams[g]);return new Promise((g,T)=>{let p,v;if(o){let b=u.set("token",o).set("token_type_hint","access_token");p=this.http.post(s,b,{headers:h})}else p=J(null);if(a){let b=u.set("token",a).set("token_type_hint","refresh_token");v=this.http.post(s,b,{headers:h})}else v=J(null);r&&(p=p.pipe(Ke(b=>b.status===0?J(null):Lt(b))),v=v.pipe(Ke(b=>b.status===0?J(null):Lt(b)))),jt([p,v]).subscribe(b=>{this.logOut(t),g(b),this.logger.info("Token successfully revoked")},b=>{this.logger.error("Error revoking token",b),this.eventsSubject.next(new V("token_revoke_error",b)),T(b)})})}clearLocationHash(){location.hash!=""&&(location.hash="")}};e.\u0275fac=function(r){return new(r||e)(C(be),C(et),C(Ei,8),C(Di,8),C(ht,8),C(qr),C(Ti),C(Ai,8),C(Te),C(Dt))},e.\u0275prov=I({token:e,factory:e.\u0275fac});let n=e;return n})(),Mi=class{},un=class{handleError(e){return Lt(e)}},To=(()=>{let e=class e{constructor(t,r,s){this.oAuthService=t,this.errorHandler=r,this.moduleConfig=s}checkUrl(t){return this.moduleConfig.resourceServer.customUrlValidation?this.moduleConfig.resourceServer.customUrlValidation(t):this.moduleConfig.resourceServer.allowedUrls?!!this.moduleConfig.resourceServer.allowedUrls.find(r=>t.toLowerCase().startsWith(r.toLowerCase())):!0}intercept(t,r){let s=t.url.toLowerCase();return!this.moduleConfig||!this.moduleConfig.resourceServer||!this.checkUrl(s)?r.handle(t):this.moduleConfig.resourceServer.sendAccessToken?Dn(J(this.oAuthService.getAccessToken()).pipe(te(a=>!!a)),this.oAuthService.events.pipe(te(a=>a.type==="token_received"),Sn(this.oAuthService.waitForTokenInMsec||0),Ke(()=>J(null)),W(()=>this.oAuthService.getAccessToken()))).pipe(Ut(1),Bt(a=>{if(a){let u="Bearer "+a,h=t.headers.set("Authorization",u);t=t.clone({headers:h})}return r.handle(t).pipe(Ke(u=>this.errorHandler.handleError(u)))})):r.handle(t).pipe(Ke(a=>this.errorHandler.handleError(a)))}};e.\u0275fac=function(r){return new(r||e)(C(Fi),C(Mi),C(Si,8))},e.\u0275prov=I({token:e,factory:e.\u0275fac});let n=e;return n})();function Eo(){return console}function Do(){return typeof sessionStorage<"u"?sessionStorage:new yo}function Ao(n=null,e=xi){return $t([Fi,qr,{provide:Ti,useFactory:Eo},{provide:Ei,useFactory:Do},{provide:Di,useClass:e},{provide:Ai,useClass:So},{provide:Mi,useClass:un},{provide:Si,useValue:n},{provide:qt,useClass:To,multi:!0},{provide:Dt,useClass:vo}])}var Qr=(()=>{let e=class e{static forRoot(t=null,r=xi){return{ngModule:e,providers:[Ao(t,r)]}}};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=j({type:e}),e.\u0275inj=L({imports:[Kn]});let n=e;return n})();var _c=new ee("AUTH_CONFIG");var Pi=class n{constructor(e,i,t,r){this.oauthService=e;this.router=i;this.location=t;this._sessionService=r;this.initOAuthServiceForCodeFlow();let s=sessionStorage.getItem("session.userInSession");s&&(this._userInSession=JSON.parse(s))}_userInSession=new ke;get userInSession(){return this._userInSession}set userInSession(e){this._userInSession=e,sessionStorage.setItem("session.userInSession",JSON.stringify(this._userInSession))}initOAuthServiceForCodeFlow(){let e={issuer:"https://www.d-defrance.fr/keycloak/realms/sandboxrealm",silentRefreshRedirectUri:window.location.origin+this.location.prepareExternalUrl("/silent-refresh.html"),useSilentRefresh:!0,postLogoutRedirectUri:window.location.origin+this.location.prepareExternalUrl("/ngr-oauth2-login-out"),clientId:"anywebappclient",responseType:"code",scope:"openid profile resource.read resource.write resource.delete",showDebugInformation:!0};this.oauthService.configure(e),this.oauthService.oidc=!0,this.oauthService.setStorage(sessionStorage),this.oauthService.loadDiscoveryDocumentAndTryLogin(),this.oauthService.events.subscribe(i=>{i instanceof $&&(console.log("OAuthSuccessEvent: "+i.type),this.manageSuccessEvent(i)),i instanceof ae&&console.log("OAuthInfoEvent: "+i.type),i instanceof V?console.log("OAuthErrorEvent: "+i.type):console.warn(i.type)})}manageSuccessEvent(e){if(e.type=="token_received"){console.log("***** token_received ****"),this._userInSession.authenticated=!0;let t=this.oauthService.getGrantedScopes();this._userInSession.grantedScopes=t,console.log("grantedScopes="+JSON.stringify(this._userInSession.grantedScopes));var i=this.oauthService.getIdentityClaims();console.log("claims="+JSON.stringify(i)),i&&(this._userInSession.username=i.preferred_username+"("+i.name+")"),this._sessionService.userInSession$=this._userInSession,this.oauthService.silentRefreshRedirectUri!=null&&this.router.navigateByUrl("/ngr-welcome")}}delegateOidcLogin(){this.oauthService.initLoginFlowInPopup()}oidcLogout(){this.oauthService.logOut(),document.cookie="AUTH_SESSION_ID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="AUTH_SESSION_ID_LEGACY=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}get accessTokenString(){return this.oauthService.getAccessToken()}static \u0275fac=function(i){return new(i||n)(C(Fi),C(Qt),C($n),C(_e))};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})};var Oi=class n{constructor(e){this.oauth2SessionService=e}login(){this.oauth2SessionService.delegateOidcLogin()}logout(){this.oauth2SessionService.oidcLogout()}ngOnInit(){}static \u0275fac=function(i){return new(i||n)(f(Pi))};static \u0275cmp=k({type:n,selectors:[["app-oauth2-log-in-out"]],decls:31,vars:0,consts:[["href","https://www.d-defrance.fr/keycloak/realms/sandboxrealm/.well-known/openid-configuration","target","_new"],[1,"redClass"],[1,"btn","btn-primary",3,"click"],["routerLink","/ngr-login"]],template:function(i,t){i&1&&(d(0,"a",0),l(1,"openid-configuration"),c(),l(2," \xA0"),d(3,"span",1),l(4,"(delete old cookies if necessary (login error) !!!)"),c(),_(5,"br"),l(6,`
LogInOut COMPONENT (login with OAuth2/OIDC keycloak server)`),_(7,"br"),d(8,"p")(9,"button",2),y("click",function(){return t.login()}),l(10,"Login"),c(),l(11," \xA0\xA0 "),d(12,"button",2),y("click",function(){return t.logout()}),l(13,"Logout"),c(),l(14," \xA0"),d(15,"span",1),l(16,"(if logout error, go back and try login)"),c()(),d(17,"div")(18,"p"),l(19,"exemples of good Username/Password:"),c(),d(20,"ul")(21,"li"),l(22,"mgr1/pwd1 (MANAGE_RW : resource.read , resource.write )"),c(),d(23,"li"),l(24,"admin1/pwd1 (ADMIN_CRUD : resource.read , resource.write , resource.delete )"),c(),d(25,"li"),l(26,"user1/pwd1 (USER : resource.read )"),c()()(),_(27,"hr"),d(28,"a",3),l(29,"direct/standalone login (without oauth2/oidc server)"),c(),l(30," \xA0 "))},dependencies:[tt],styles:[".redClass[_ngcontent-%COMP%]{color:red}"]})};var Mt=class{constructor(e="?",i="?",t=1){this.code=e;this.name=i;this.change=t}};function Po(n,e){if(n&1){let i=le();d(0,"tr",21),y("click",function(){let r=E(i).$implicit,s=oe();return D(s.onSelectDevise(r))}),d(1,"td"),l(2),c(),d(3,"td"),l(4),c(),d(5,"td"),l(6),c()()}if(n&2){let i=e.$implicit,t=oe();se("selected",i==t.selectedDevise),m(2),A(i.code),m(2),A(i.name),m(2),A(i.change)}}var Ri=class n{constructor(e){this.deviseService=e}platform=ne(Se);cloneDevise(e){return JSON.parse(JSON.stringify(e))}identifyDevise(e,i){return i.code}tabDevises=[];selectedDevise;deviseTemp=new Mt;message="";mode="newOne";onNew(){this.mode="newOne",this.selectedDevise=void 0,this.deviseTemp=new Mt}onAdd(){return z(this,null,function*(){try{let e=yield ge(this.deviseService.postDevise$(this.deviseTemp));this.message="devise ajout\xE9e",this.addClientSide(e)}catch(e){this.message=Et(e,"echec post")}})}addClientSide(e){this.tabDevises.push(e),this.onNew()}onDelete(){return z(this,null,function*(){if(this.selectedDevise)try{yield ge(this.deviseService.deleteDevise$(this.selectedDevise.code)),this.message="devise bien supprim\xE9e",this.deleteClientSide()}catch(e){this.message=Et(e,"echec suppression")}})}deleteClientSide(){if(this.selectedDevise){let e=-1;this.tabDevises.forEach((i,t)=>{i==this.selectedDevise&&(e=t)}),e>=0&&this.tabDevises.splice(e,1)}this.onNew()}onUpdateV1(){return z(this,null,function*(){try{let e=yield ge(this.deviseService.putDevise$(this.deviseTemp));this.message="devise bien mise \xE0 jour",this.updateClientSide(e)}catch(e){this.message=Et(e,"echec update (put)")}})}onUpdate(){this.deviseService.putDevise$(this.deviseTemp).subscribe({next:e=>{this.message="devise bien mise \xE0 jour",this.updateClientSide(e)},error:e=>{Ge(e,"echec update (put)")}})}updateClientSide(e){this.selectedDevise!=null&&(this.selectedDevise.code=e.code,this.selectedDevise.name=e.name,this.selectedDevise.change=e.change)}onSelectDevise(e){this.selectedDevise=e,this.mode="existingOne",this.deviseTemp=this.cloneDevise(this.selectedDevise),this.message="devise selectionn\xE9e = "+JSON.stringify(this.selectedDevise)}ngOnInit(){Ce(this.platform)&&this.fetchDevises()}fetchDevises(){return z(this,null,function*(){try{this.tabDevises=yield ge(this.deviseService.getAllDevises$().pipe(W(e=>e.sort((i,t)=>i.change-t.change))))}catch(e){this.message=Et(e,"echec rechercherDevises (get)")}})}static \u0275fac=function(i){return new(i||n)(f(ut))};static \u0275cmp=k({type:n,selectors:[["app-devise"]],decls:56,vars:16,consts:[["formDevise","ngForm"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-sm-5"],[1,"card"],[1,"card-header","text-white","bg-primary"],[1,"card-body"],[1,"table","table-bordered"],[3,"selected","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-sm-7"],[1,"row","form-group"],[1,"col-sm-3","text-sm-end","form-label"],[1,"col-sm-9"],["name","code","required","","minlength","3",1,"form-control","mb-1",3,"ngModelChange","ngModel"],["name","nom","required","",1,"form-control","mb-1",3,"ngModelChange","ngModel"],["name","change","type","number","required","",1,"form-control","mb-1",3,"ngModelChange","ngModel"],[1,"col-sm-9","offset-sm-3"],[1,"btn-primary",3,"click","disabled"],[1,"bi-save"],[1,"btn-primary",3,"click"],[1,"btn-danger",3,"click"],[3,"click"]],template:function(i,t){if(i&1){let r=le();d(0,"input",1),R("ngModelChange",function(o){return E(r),O(t.deviseService.withoutSecurity,o)||(t.deviseService.withoutSecurity=o),D(o)}),c(),l(1,` withoutSecurity (development only)
`),d(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),l(6,"Liste des devises (selon serveur)"),c(),d(7,"div",6)(8,"table",7)(9,"tr")(10,"th"),l(11,"code"),c(),d(12,"th"),l(13,"name"),c(),d(14,"th"),l(15,"change"),c()(),B(16,Po,7,5,"tr",8),c(),l(17," message: "),d(18,"b"),l(19),c()()()(),d(20,"div",9)(21,"div",4)(22,"div",5),l(23),c(),d(24,"div",6)(25,"form",null,0)(27,"div",10)(28,"label",11),l(29,"code:"),c(),d(30,"div",12)(31,"input",13),R("ngModelChange",function(o){return E(r),O(t.deviseTemp.code,o)||(t.deviseTemp.code=o),D(o)}),c()()(),d(32,"div",10)(33,"label",11),l(34,"name:"),c(),d(35,"div",12)(36,"input",14),R("ngModelChange",function(o){return E(r),O(t.deviseTemp.name,o)||(t.deviseTemp.name=o),D(o)}),c()()(),d(37,"div",10)(38,"label",11),l(39,"change:"),c(),d(40,"div",12)(41,"input",15),R("ngModelChange",function(o){return E(r),O(t.deviseTemp.change,o)||(t.deviseTemp.change=o),D(o)}),c()()(),d(42,"div",10)(43,"div",16)(44,"button",17),y("click",function(){return E(r),D(t.onUpdate())}),l(45," update "),_(46,"i",18),c(),l(47," \xA0 "),d(48,"button",19),y("click",function(){return E(r),D(t.onNew())}),l(49," new "),c(),l(50," \xA0 "),d(51,"button",17),y("click",function(){return E(r),D(t.onAdd())}),l(52," add "),c(),l(53," \xA0 "),d(54,"button",20),y("click",function(){return E(r),D(t.onDelete())}),l(55," delete "),c()()()()()()()()}if(i&2){let r=Le(26);P("ngModel",t.deviseService.withoutSecurity),m(16),S("ngForOf",t.tabDevises)("ngForTrackBy",t.identifyDevise),m(3),A(t.message),m(4),H("devise selectionn\xE9e (",t.mode,")"),m(8),P("ngModel",t.deviseTemp.code),m(5),P("ngModel",t.deviseTemp.name),m(5),P("ngModel",t.deviseTemp.change),m(3),q("visibility",t.mode=="existingOne"?"visible":"hidden"),S("disabled",!r.form.valid),m(7),q("visibility",t.mode=="newOne"?"visible":"hidden"),S("disabled",!r.form.valid),m(3),q("visibility",t.mode=="existingOne"?"visible":"hidden")}},dependencies:[de,at,Q,Ie,Yi,Z,ot,We,Tt,X,St],styles:[".selected[_ngcontent-%COMP%]{color:#00f;font-weight:700}"]})};var Vi=class n{constructor(e){this._formBuilder=e;this.resaForm=this._formBuilder.group({firstName:["prenom",ue.required],lastName:["Nom",[ue.required,ue.pattern("[A-Z].+")]],telephone:["0605040302",[ue.required,ue.minLength(10)]],email:["prenom.Nom@xyz.com",[ue.required,ue.email]],dateTime:[new Date().toISOString().substring(0,16),[ue.required,ue.pattern("[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}.*")]]})}resaForm;message="";onReservation(){this.message="r\xE9sa effectu\xE9e="+JSON.stringify(this.resaForm.value)}static \u0275fac=function(i){return new(i||n)(f(jr))};static \u0275cmp=k({type:n,selectors:[["app-reservation"]],decls:31,vars:3,consts:[["novalidate","",3,"formGroup"],[1,"form-group","row"],[1,"col-sm-3"],[1,"col-sm-9"],["type","text","formControlName","firstName",1,"form-control"],["type","text","formControlName","lastName",1,"form-control"],["type","telephone","formControlName","telephone",1,"form-control"],["type","email","formControlName","email",1,"form-control"],["type","text","formControlName","dateTime",1,"form-control"],["type","button","value","reservation",3,"click","disabled"]],template:function(i,t){i&1&&(d(0,"h3"),l(1,"reservation"),c(),d(2,"form",0)(3,"div",1)(4,"label",2),l(5,"firstName:"),c(),d(6,"div",3),_(7,"input",4),c()(),d(8,"div",1)(9,"label",2),l(10,"lastName:"),c(),d(11,"div",3),_(12,"input",5),c()(),d(13,"div",1)(14,"label",2),l(15,"telephone:"),c(),d(16,"div",3),_(17,"input",6),c()(),d(18,"div",1)(19,"label",2),l(20,"email:"),c(),d(21,"div",3),_(22,"input",7),c()(),d(23,"div",1)(24,"label",2),l(25,"dateTime:"),c(),d(26,"div",3),_(27,"input",8),c()(),d(28,"input",9),y("click",function(){return t.onReservation()}),c(),_(29,"hr"),l(30),c()),i&2&&(m(2),S("formGroup",t.resaForm),m(26),S("disabled",!t.resaForm.valid),m(2),H(" ",t.message,`
`))},dependencies:[at,Q,Z,ot,rn,sn]})};var Oo=[{path:"ngr-welcome",component:yi},{path:"",redirectTo:"/ngr-welcome",pathMatch:"full"},{path:"ngr-basic",component:ci,children:[{path:"tva",component:hi},{path:"calculatrice/:mode",component:li},{path:"",redirectTo:"tva",pathMatch:"prefix"}]},{path:"ngr-login",component:ki},{path:"ngr-oauth2-login-out",component:Oi},{path:"ngr-devise",component:Ri},{path:"ngr-conversion",component:mi,canActivate:[Gr]},{path:"ngr-reservation",component:Vi},{path:"ngr-demo",component:_i}],Ni=class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=j({type:n});static \u0275inj=L({imports:[$i.forRoot(Oo),$i]})};var mt=class n{platform=ne(Se);_couleurFondPreferee;get couleurFondPreferee(){return this._couleurFondPreferee}set couleurFondPreferee(e){this._couleurFondPreferee=e,Ce(this.platform)&&(console.warn("browser platform (csr)"),localStorage&&localStorage.setItem("preferences.couleurFond",e))}constructor(){let e="lightgrey";Ce(this.platform)&&localStorage&&(e=localStorage.getItem("preferences.couleurFond")),this._couleurFondPreferee=e||"lightgrey"}static \u0275fac=function(i){return new(i||n)};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})};function Ro(n,e){n&1&&(d(0,"span",10),_(1,"i",11),c())}var Li=class n{constructor(e,i){this.preferencesService=e;this._sessionService=i;console.log("dans constructeur de HeaderComponent , titre="+this.titre),i.userInSession$.subscribe(t=>{this.isConnected=t.authenticated})}isConnected=!1;titre="titreParDefaut";ngOnChanges(e){console.log("ngOnChanges avec changes="+JSON.stringify(e))}ngOnInit(){console.log("dans ngOnInit() de HeaderComponent , titre="+this.titre)}static \u0275fac=function(i){return new(i||n)(f(mt),f(_e))};static \u0275cmp=k({type:n,selectors:[["app-header"]],inputs:{titre:"titre"},features:[ve],decls:28,vars:4,consts:[[1,"entete"],["class","badge bg-primary",4,"ngIf"],["routerLink","/ngr-welcome"],["routerLink","/ngr-basic"],["routerLink","/ngr-reservation"],["routerLink","/ngr-login"],["routerLink","/ngr-oauth2-login-out"],["routerLink","/ngr-conversion"],["routerLink","/ngr-devise"],["routerLink","/ngr-demo"],[1,"badge","bg-primary"],[1,"bi-person"]],template:function(i,t){i&1&&(d(0,"p",0),l(1),B(2,Ro,2,0,"span",1),l(3," \xA0 "),d(4,"a",2),l(5,"welcome"),c(),l(6," \xA0 "),d(7,"a",3),l(8,"basic"),c(),l(9," \xA0 "),d(10,"a",4),l(11,"reservation"),c(),l(12," \xA0 "),d(13,"a",5),l(14,"login (standalone)"),c(),l(15," \xA0 "),d(16,"a",6),l(17,"OAuth2 logInOut"),c(),l(18," \xA0 "),d(19,"a",7),l(20,"conversion"),c(),l(21," \xA0 "),d(22,"a",8),l(23,"devise(crud)"),c(),l(24," \xA0 "),d(25,"a",9),l(26,"demo"),c(),l(27,` \xA0
`),c()),i&2&&(q("background-color",t.preferencesService.couleurFondPreferee),m(),H(" ",t.titre," \xA0 "),m(),S("ngIf",t.isConnected))},dependencies:[Je,tt],styles:[".entete[_ngcontent-%COMP%]{background-color:#d3d3d3}"]})};function No(n,e){if(n&1&&(d(0,"option",3),l(1),c()),n&2){let i=e.$implicit;S("ngValue",i),m(),A(i)}}var ji=class n{constructor(e,i){this.preferencesService=e;this._sessionService=i;i.userInSession$.subscribe(t=>{t.authenticated?this.username=t.username:this.username="?"})}today=new Date;username="?";listeCouleurs=["lightyellow","white","lightgrey","lightgreen","lightpink","lightblue"];static \u0275fac=function(i){return new(i||n)(f(mt),f(_e))};static \u0275cmp=k({type:n,selectors:[["app-footer"]],decls:6,vars:7,consts:[[1,"piedPage"],[3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"]],template:function(i,t){i&1&&(d(0,"p",0),l(1),je(2,"date"),d(3,"select",1),R("ngModelChange",function(s){return O(t.preferencesService.couleurFondPreferee,s)||(t.preferencesService.couleurFondPreferee=s),s}),B(4,No,2,2,"option",2),c(),l(5),c()),i&2&&(m(),H("footer , date=",gt(2,4,t.today,"dd/MM/yyyy")," \xA0 couleurFondPreferee: "),m(2),P("ngModel",t.preferencesService.couleurFondPreferee),m(),S("ngForOf",t.listeCouleurs),m(),H(" \xA0 username=",t.username,`
`))},dependencies:[de,ct,lt,Me,Z,X,zn],styles:[".piedPage[_ngcontent-%COMP%]{background-color:#dbf38d}"]})};var pt=class n{title="my-app";static \u0275fac=function(i){return new(i||n)};static \u0275cmp=k({type:n,selectors:[["app-root"]],decls:4,vars:1,consts:[[1,"container-fluid"],[3,"titre"]],template:function(i,t){i&1&&(d(0,"div",0),_(1,"app-header",1)(2,"router-outlet")(3,"app-footer"),c()),i&2&&(m(),S("titre",t.title))},dependencies:[Kt,Li,ji]})};var jo="@",Bo=(()=>{let e=class e{constructor(t,r,s,o,a){this.doc=t,this.delegate=r,this.zone=s,this.animationType=o,this.moduleImpl=a,this._rendererFactoryPromise=null,this.scheduler=ne(jn,{optional:!0}),this.loadingSchedulerFn=ne(Ho,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){let t=()=>this.moduleImpl??import("./chunk-MBVBWLDT.mjs").then(s=>s),r;return this.loadingSchedulerFn?r=this.loadingSchedulerFn(t):r=t(),r.catch(s=>{throw new Qe(5300,!1)}).then(({\u0275createEngine:s,\u0275AnimationRendererFactory:o})=>{this._engine=s(this.animationType,this.doc);let a=new o(this.delegate,this._engine,this.zone);return this.delegate=a,a})}createRenderer(t,r){let s=this.delegate.createRenderer(t,r);if(s.\u0275type===0)return s;typeof s.throwOnSyntheticProps=="boolean"&&(s.throwOnSyntheticProps=!1);let o=new hn(s);return r?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(a=>{let u=a.createRenderer(t,r);o.use(u),this.scheduler?.notify(10)}).catch(a=>{o.use(s)}),o}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};e.\u0275fac=function(r){Ln()},e.\u0275prov=I({token:e,factory:e.\u0275fac});let n=e;return n})(),hn=class{constructor(e){this.delegate=e,this.replay=[],this.\u0275type=1}use(e){if(this.delegate=e,this.replay!==null){for(let i of this.replay)i(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,i){return this.delegate.createElement(e,i)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,i){this.delegate.appendChild(e,i)}insertBefore(e,i,t,r){this.delegate.insertBefore(e,i,t,r)}removeChild(e,i,t){this.delegate.removeChild(e,i,t)}selectRootElement(e,i){return this.delegate.selectRootElement(e,i)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,i,t,r){this.delegate.setAttribute(e,i,t,r)}removeAttribute(e,i,t){this.delegate.removeAttribute(e,i,t)}addClass(e,i){this.delegate.addClass(e,i)}removeClass(e,i){this.delegate.removeClass(e,i)}setStyle(e,i,t,r){this.delegate.setStyle(e,i,t,r)}removeStyle(e,i,t){this.delegate.removeStyle(e,i,t)}setProperty(e,i,t){this.shouldReplay(i)&&this.replay.push(r=>r.setProperty(e,i,t)),this.delegate.setProperty(e,i,t)}setValue(e,i){this.delegate.setValue(e,i)}listen(e,i,t){return this.shouldReplay(i)&&this.replay.push(r=>r.listen(e,i,t)),this.delegate.listen(e,i,t)}shouldReplay(e){return this.replay!==null&&e.startsWith(jo)}},Ho=new ee("");function Yr(n="animations"){return Hn("NgAsyncAnimations"),$t([{provide:Bn,useFactory:(e,i,t)=>new Bo(e,i,t,n),deps:[Te,Jn,be]},{provide:Wi,useValue:n==="noop"?"NoopAnimations":"BrowserAnimations"}])}var mn;try{mn=typeof Intl<"u"&&Intl.v8BreakIterator}catch{mn=!1}var Pt=(()=>{let e=class e{constructor(t){this._platformId=t,this.isBrowser=this._platformId?Ce(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||mn)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};e.\u0275fac=function(r){return new(r||e)(C(Se))},e.\u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Ft;function Uo(){if(Ft==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Ft=!0}))}finally{Ft=Ft||!1}return Ft}function pn(n){return Uo()?n:!!n.capture}function Jr(n){return n.composedPath?n.composedPath()[0]:n.target}function Xr(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function fn(n){return Array.isArray(n)?n:[n]}function gn(n){return n instanceof re?n.nativeElement:n}var ts=new Set,ze,Wo=(()=>{let e=class e{constructor(t,r){this._platform=t,this._nonce=r,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):$o}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&Go(t,this._nonce),this._matchMedia(t)}};e.\u0275fac=function(r){return new(r||e)(C(Pt),C(Nn,8))},e.\u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function Go(n,e){if(!ts.has(n))try{ze||(ze=document.createElement("style"),e&&ze.setAttribute("nonce",e),ze.setAttribute("type","text/css"),document.head.appendChild(ze)),ze.sheet&&(ze.sheet.insertRule(`@media ${n} {body{ }}`,0),ts.add(n))}catch(i){console.error(i)}}function $o(n){return{matches:n==="all"||n==="",media:n,addListener:()=>{},removeListener:()=>{}}}var ns=(()=>{let e=class e{constructor(t,r){this._mediaMatcher=t,this._zone=r,this._queries=new Map,this._destroySubject=new Ve}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return is(fn(t)).some(s=>this._registerQuery(s).mql.matches)}observe(t){let s=is(fn(t)).map(a=>this._registerQuery(a).observable),o=jt(s);return o=Tn(o.pipe(Ut(1)),o.pipe(Fn(1),Ht(0))),o.pipe(W(a=>{let u={matches:!1,breakpoints:{}};return a.forEach(({matches:h,query:g})=>{u.matches=u.matches||h,u.breakpoints[g]=h}),u}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);let r=this._mediaMatcher.matchMedia(t),o={observable:new xn(a=>{let u=h=>this._zone.run(()=>a.next(h));return r.addListener(u),()=>{r.removeListener(u)}}).pipe(Pn(r),W(({matches:a})=>({query:t,matches:a})),Rn(this._destroySubject)),mql:r};return this._queries.set(t,o),o}};e.\u0275fac=function(r){return new(r||e)(C(Wo),C(be))},e.\u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function is(n){return n.map(e=>e.split(",")).reduce((e,i)=>e.concat(i)).map(e=>e.trim())}function as(n){return n.buttons===0||n.detail===0}function cs(n){let e=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!!e&&e.identifier===-1&&(e.radiusX==null||e.radiusX===1)&&(e.radiusY==null||e.radiusY===1)}var qe=function(n){return n[n.NONE=0]="NONE",n[n.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",n[n.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",n}(qe||{}),rs="cdk-high-contrast-black-on-white",ss="cdk-high-contrast-white-on-black",bn="cdk-high-contrast-active",ls=(()=>{let e=class e{constructor(t,r){this._platform=t,this._document=r,this._breakpointSubscription=ne(ns).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return qe.NONE;let t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);let r=this._document.defaultView||window,s=r&&r.getComputedStyle?r.getComputedStyle(t):null,o=(s&&s.backgroundColor||"").replace(/ /g,"");switch(t.remove(),o){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return qe.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return qe.BLACK_ON_WHITE}return qe.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let t=this._document.body.classList;t.remove(bn,rs,ss),this._hasCheckedHighContrastMode=!0;let r=this.getHighContrastMode();r===qe.BLACK_ON_WHITE?t.add(bn,rs):r===qe.WHITE_ON_BLACK&&t.add(bn,ss)}}};e.\u0275fac=function(r){return new(r||e)(C(Pt),C(Te))},e.\u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var _n=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=j({type:e}),e.\u0275inj=L({});let n=e;return n})();function ea(){return!0}var ta=new ee("mat-sanity-checks",{providedIn:"root",factory:ea}),Cn=(()=>{let e=class e{constructor(t,r,s){this._sanityChecks=r,this._document=s,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return Xr()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[t]}};e.\u0275fac=function(r){return new(r||e)(C(ls),C(ta,8),C(Te))},e.\u0275mod=j({type:e}),e.\u0275inj=L({imports:[_n,_n]});let n=e;return n})();var he=function(n){return n[n.FADING_IN=0]="FADING_IN",n[n.VISIBLE=1]="VISIBLE",n[n.FADING_OUT=2]="FADING_OUT",n[n.HIDDEN=3]="HIDDEN",n}(he||{}),vn=class{constructor(e,i,t,r=!1){this._renderer=e,this.element=i,this.config=t,this._animationForciblyDisabledThroughCss=r,this.state=he.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},ds=pn({passive:!0,capture:!0}),yn=class{constructor(){this._events=new Map,this._delegateEventHandler=e=>{let i=Jr(e);i&&this._events.get(e.type)?.forEach((t,r)=>{(r===i||r.contains(i))&&t.forEach(s=>s.handleEvent(e))})}}addHandler(e,i,t,r){let s=this._events.get(i);if(s){let o=s.get(t);o?o.add(r):s.set(t,new Set([r]))}else this._events.set(i,new Map([[t,new Set([r])]])),e.runOutsideAngular(()=>{document.addEventListener(i,this._delegateEventHandler,ds)})}removeHandler(e,i,t){let r=this._events.get(e);if(!r)return;let s=r.get(i);s&&(s.delete(t),s.size===0&&r.delete(i),r.size===0&&(this._events.delete(e),document.removeEventListener(e,this._delegateEventHandler,ds)))}},us={enterDuration:225,exitDuration:150},ia=800,hs=pn({passive:!0,capture:!0}),ms=["mousedown","touchstart"],ps=["mouseup","mouseleave","touchend","touchcancel"],Ot=class Ot{constructor(e,i,t,r){this._target=e,this._ngZone=i,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=gn(t))}fadeInRipple(e,i,t={}){let r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s=U(U({},us),t.animation);t.centered&&(e=r.left+r.width/2,i=r.top+r.height/2);let o=t.radius||na(e,i,r),a=e-r.left,u=i-r.top,h=s.enterDuration,g=document.createElement("div");g.classList.add("mat-ripple-element"),g.style.left=`${a-o}px`,g.style.top=`${u-o}px`,g.style.height=`${o*2}px`,g.style.width=`${o*2}px`,t.color!=null&&(g.style.backgroundColor=t.color),g.style.transitionDuration=`${h}ms`,this._containerElement.appendChild(g);let T=window.getComputedStyle(g),p=T.transitionProperty,v=T.transitionDuration,b=p==="none"||v==="0s"||v==="0s, 0s"||r.width===0&&r.height===0,F=new vn(this,g,t,b);g.style.transform="scale3d(1, 1, 1)",F.state=he.FADING_IN,t.persistent||(this._mostRecentTransientRipple=F);let N=null;return!b&&(h||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let fe=()=>{N&&(N.fallbackTimer=null),clearTimeout(x),this._finishRippleTransition(F)},xe=()=>this._destroyRipple(F),x=setTimeout(xe,h+100);g.addEventListener("transitionend",fe),g.addEventListener("transitioncancel",xe),N={onTransitionEnd:fe,onTransitionCancel:xe,fallbackTimer:x}}),this._activeRipples.set(F,N),(b||!h)&&this._finishRippleTransition(F),F}fadeOutRipple(e){if(e.state===he.FADING_OUT||e.state===he.HIDDEN)return;let i=e.element,t=U(U({},us),e.config.animation);i.style.transitionDuration=`${t.exitDuration}ms`,i.style.opacity="0",e.state=he.FADING_OUT,(e._animationForciblyDisabledThroughCss||!t.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){let i=gn(e);!this._platform.isBrowser||!i||i===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=i,ms.forEach(t=>{Ot._eventManager.addHandler(this._ngZone,t,i,this)}))}handleEvent(e){e.type==="mousedown"?this._onMousedown(e):e.type==="touchstart"?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{ps.forEach(i=>{this._triggerElement.addEventListener(i,this,hs)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){e.state===he.FADING_IN?this._startFadeOutTransition(e):e.state===he.FADING_OUT&&this._destroyRipple(e)}_startFadeOutTransition(e){let i=e===this._mostRecentTransientRipple,{persistent:t}=e.config;e.state=he.VISIBLE,!t&&(!i||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){let i=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=he.HIDDEN,i!==null&&(e.element.removeEventListener("transitionend",i.onTransitionEnd),e.element.removeEventListener("transitioncancel",i.onTransitionCancel),i.fallbackTimer!==null&&clearTimeout(i.fallbackTimer)),e.element.remove()}_onMousedown(e){let i=as(e),t=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+ia;!this._target.rippleDisabled&&!i&&!t&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!cs(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let i=e.changedTouches;if(i)for(let t=0;t<i.length;t++)this.fadeInRipple(i[t].clientX,i[t].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{let i=e.state===he.VISIBLE||e.config.terminateOnPointerUp&&e.state===he.FADING_IN;!e.config.persistent&&i&&e.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let e=this._triggerElement;e&&(ms.forEach(i=>Ot._eventManager.removeHandler(i,e,this)),this._pointerUpEventsRegistered&&(ps.forEach(i=>e.removeEventListener(i,this,hs)),this._pointerUpEventsRegistered=!1))}};Ot._eventManager=new yn;var fs=Ot;function na(n,e,i){let t=Math.max(Math.abs(n-i.left),Math.abs(n-i.right)),r=Math.max(Math.abs(e-i.top),Math.abs(e-i.bottom));return Math.sqrt(t*t+r*r)}var gs=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=j({type:e}),e.\u0275inj=L({imports:[Cn,Cn]});let n=e;return n})();var Bi=class n{intercept(e,i){let t=sessionStorage.getItem("access_token");if(t&&t!=""&&t!="null"){let r=e.clone({headers:e.headers.set("Authorization","Bearer "+t)});return console.log("MyAuthInterceptor , adding Bearer token="+t),i.handle(r)}else return i.handle(e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=I({token:n,factory:n.\u0275fac})};var Hi=class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=j({type:n,bootstrap:[pt]});static \u0275inj=L({providers:[er(),Zn(Yn()),Yr(),{provide:qt,useClass:Bi,multi:!0}],imports:[Xn,Ni,Br,Hr,gs,Qr.forRoot()]})};var wn=class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=j({type:n,bootstrap:[pt]});static \u0275inj=L({imports:[Hi,tr]})};export{wn as a};
